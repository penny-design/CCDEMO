<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp官方抽奖工具 - 活力年轻型</title>
    <meta name="description" content="WhatsApp官方抽奖工具，验证账号即可参与iPhone 15 Pro抽奖活动">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* WhatsApp官方抽奖工具设计令牌系统 */
        :root {
            /* WhatsApp官方色彩 - 采用官方绿色 #25D366 */
            --whatsapp-primary: #25D366;
            --whatsapp-secondary: #128C7E;
            --whatsapp-dark: #075E54;
            --whatsapp-light: #DCF8C6;

            /* 主色系 - 基于WhatsApp官方色 */
            --color-primary: #25D366;
            --color-primary-dark: #128C7E;
            --color-primary-light: #DCF8C6;
            --color-primary-50: #F0FBF3;
            --color-primary-700: #075E54;

            /* 参考文件的布局变量 - 严格保持一致 */
            --color-bg: #f8fafc;
            --color-surface: #ffffff;
            --color-text: #0f172a;
            --color-muted: #64748b;
            --color-border: #e2e8f0;
            --color-urgent-bg: #fff7ed;
            --color-urgent-border: #fed7aa;
            --color-urgent-text: #b45309;

            /* 阴影系统 - 对齐参考文件 */
            --shadow-sm: 0 1px 2px rgba(2,6,23,0.06);
            --shadow-md: 0 6px 16px rgba(2,6,23,0.08);

            /* 间距系统 - 保持参考文件一致 */
            --pad-card: 16px;
            --gap-section: 12px;

            /* 圆角系统 - 对齐参考文件 */
            --radius-md: 12px;
            --radius-lg: 16px;

            /* CCPM页眉设计令牌系统 */
            --header-height-mobile: 56px;
            --header-height-tablet: 64px;
            --header-height-desktop: 72px;

            --header-bg: #ffffff;
            --header-border: var(--color-border);
            --header-shadow: 0 1px 3px rgba(0,0,0,0.1);

            --header-logo-width-mobile: 24px;
            --header-logo-width-tablet: 28px;
            --header-logo-width-desktop: 32px;

            --header-font-size-mobile: 16px;
            --header-font-size-tablet: 18px;
            --header-font-size-desktop: 20px;

            --header-spacing-mobile: 8px 12px;
            --header-spacing-tablet: 12px 20px;
            --header-spacing-desktop: 16px 24px;

            --header-menu-width: 280px;
            --header-menu-shadow: 0 4px 12px rgba(0,0,0,0.15);
            --header-menu-backdrop: rgba(0,0,0,0.5);

            --header-transition-speed: 0.3s;
            --header-hover-bg: rgba(37, 211, 102, 0.1);
            --header-active-bg: rgba(37, 211, 102, 0.2);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.5;
            margin: 0;
        }

        .container {
            max-width: 720px;
            margin: 0 auto;
            padding: 0 16px;
        }

        /* 导航栏结构 - 严格对齐参考文件 */
        header {
            position: sticky;
            top: 0;
            z-index: 10;
            background: rgba(248,250,252,.95);
            backdrop-filter: saturate(1.2) blur(6px);
            border-bottom: 1px solid var(--color-border);
        }

        .topbar {
            display:flex;
            align-items:center;
            justify-content:center;
            height: 48px;
        }

        .page-title {
            font-weight: 600;
            font-size: 15px;
            color: var(--color-primary-dark);
        }

        .nav-btn, nav .lang {
            display: none;
        }

        main {
            padding: 0 0 24px;
        }

        section.card {
            margin: var(--gap-section) 0;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .card-body {
            padding: var(--pad-card);
        }

        /* Hero 结构 - 严格对齐参考文件 */
        .card-hero .card-body {
            padding: 0 12px 0;
        }

        .hero-banner {
            position: relative;
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--color-border);
            background: linear-gradient(135deg, var(--color-primary-50), #ffffff);
            margin: 0 -12px;
        }

        .hero-banner .img {
            aspect-ratio: 340/180;
            width: 100%;
            display:flex;
            align-items:center;
            justify-content:center;
            color: var(--color-muted);
        }

        /* Ticker 结构 - 对齐参考文件 */
        .ticker {
            position: absolute;
            top: 10px;
            left: 10px;
            max-width: clamp(120px, 42vw, 180px);
            height: 28px;
            display:flex;
            align-items:center;
            gap: 8px;
            padding: 0 10px;
            border-radius: 999px;
            background: rgba(255,255,255,.85);
            border: 1px solid var(--color-border);
            backdrop-filter: saturate(1.2) blur(4px);
            overflow: hidden;
            z-index: 2;
        }

        .ticker-track {
            display:inline-flex;
            gap: 24px;
            white-space: nowrap;
            animation: tickerx 18s linear infinite;
        }

        .ticker.paused .ticker-track {
            animation-play-state: paused;
        }

        @media (prefers-reduced-motion: reduce) {
            .ticker-track {
                animation: none;
            }
        }

        @keyframes tickerx {
            from {
                transform: translateX(0);
            } to {
                transform: translateX(-50%);
            }
        }

        .avatar-sm {
            width: 18px;
            height: 18px;
            border-radius: 999px;
            background: #cbd5e1;
            border: 1px solid #fff;
            box-shadow: var(--shadow-sm);
        }

        /* Hero Meta 结构 - 对齐参考文件，确保独立分离 */
        .hero-meta {
            display:flex;
            align-items:flex-end;
            justify-content:space-between;
            gap: 12px;
            flex-wrap: wrap;
            padding: var(--pad-card) var(--pad-card) 0;
        }

        .meta-left {
            display:flex;
            flex-direction:column;
            gap:4px;
        }

        .meta-title {
            font-weight: 700;
            color: var(--color-primary-dark);
        }

        /* Countdown 结构 - 严格对齐参考文件 */
        #countdown-card .card-body {
            padding: 12px;
        }

        .countdown-grid {
            display:grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
        }

        .cd-box {
            background: var(--color-primary-50);
            border: 1px solid rgba(67, 205, 102, 0.35);
            border-radius: 10px;
            min-height: 42px;
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center;
            box-shadow: var(--shadow-sm);
        }

        .cd-number {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
            font-weight: 700;
            font-size: 14px;
            color: var(--color-primary-700);
            line-height: 1;
        }

        .cd-label {
            color: var(--color-muted);
            font-size: 10px;
            margin-top: 2px;
        }

        .end-time-center {
            text-align: center;
            margin-top: 8px;
            color: var(--color-text);
            font-weight: 400;
            font-size: 12.5px;
        }

        .countdown-urgent .cd-box {
            background: var(--color-urgent-bg);
            border-color: var(--color-urgent-border);
        }

        .countdown-urgent .cd-number {
            color: var(--color-urgent-text);
        }

        /* Sponsor 结构 - 对齐参考文件 */
        .sponsor {
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap: 16px;
            flex-wrap: wrap;
        }

        .sponsor-left {
            display:flex;
            align-items:center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        /* CTA 结构 - 严格对齐参考文件 */
        .cta-wrap {
            margin: var(--gap-section) 0;
            padding: var(--pad-card);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            display:flex;
            flex-direction:column;
            align-items:center;
            gap: 12px;
        }

        .btn-cta-round {
            width: clamp(128px, 36vw, 180px);
            height: clamp(128px, 36vw, 180px);
            border-radius: 999px;
            background: var(--color-primary);
            color: #fff;
            border: none;
            font-weight: 800;
            font-size: clamp(16px, 4.2vw, 20px);
            box-shadow: 0 20px 38px rgba(67, 205, 102, 0.25), inset 0 -4px 0 rgba(0,0,0,.12);
            cursor: pointer;
            transition: transform .15s ease, box-shadow .15s ease;
        }

        .btn-cta-round:hover {
            transform: translateY(-2px);
            box-shadow: 0 26px 48px rgba(67, 205, 102, 0.3), inset 0 -4px 0 rgba(0,0,0,.12);
        }

        .cta-hint {
            background: white;
            border: 1px solid var(--color-border);
            color: var(--color-text);
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 12px;
            box-shadow: var(--shadow-sm);
        }

        .avatars {
            display:flex;
        }

        .avatar {
            width: 28px;
            height: 28px;
            border-radius:999px;
            background:#cbd5e1;
            border:2px solid white;
            box-shadow: var(--shadow-sm);
            margin-left:-8px;
        }

        .avatar:first-child {
            margin-left: 0;
        }

        .cta-sub {
            color: var(--color-muted);
            font-size: 12px;
        }

        /* Footer 结构 - 对齐参考文件 */
        footer {
            margin: 24px 0 16px;
            color: var(--color-muted);
            font-size: 12px;
            text-align: center;
        }

        footer a {
            color: var(--color-primary);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Sticky CTA 结构 - 对齐参考文件 */
        .sticky-cta {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            transform: translateY(100%);
            transition: transform .25s ease;
            background: rgba(255,255,255,.95);
            backdrop-filter: saturate(1.2) blur(6px);
            border-top: 1px solid var(--color-border);
            padding: 10px 16px calc(10px + env(safe-area-inset-bottom));
            display:flex;
            align-items:center;
            justify-content: space-between;
            gap: 12px;
            z-index: 20;
        }

        .sticky-cta.visible {
            transform: translateY(0);
        }

        .btn-cta-round .main-text {
            font-size: clamp(16px, 4.2vw, 20px);
        }

  
        .sticky-cta .btn-cta-round {
            width: 48px;
            height: 48px;
            font-size: 0;
        }

        .sticky-cta .btn-cta-round::after {
            content: "Go";
            font-size: 16px;
        }

        /* 响应式设计 - 严格对齐参考文件 */
        @media (max-width: 768px) {
            .container {
                padding: 0 12px;
            }

            .hero-banner {
                margin: 0 -12px;
            }

            .ticker {
                max-width: clamp(80px, 25vw, 120px);
                height: 24px;
            }
        }

        /* 功能图标样式 */
        .nav-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            color: var(--color-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .nav-icon:hover {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
            transform: translateY(-1px);
        }

        .nav-icon.authenticated {
            color: var(--color-text);
            border-color: var(--color-primary);
        }

        .nav-icon.authenticated:hover {
            background: var(--color-primary);
            color: white;
        }

        /* 未登录状态的图标样式 */
        .nav-icon.authenticated-only {
            opacity: 0.4;
            cursor: not-allowed;
            position: relative;
        }

        .nav-icon.authenticated-only::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(2px);
        }

        .nav-icon.authenticated-only:hover {
            opacity: 0.6;
            transform: none;
        }

        /* 用户状态指示器 */
        .user-avatar.authenticated {
            background: var(--color-primary);
        }

        .user-status-text.authenticated {
            color: var(--color-primary);
            font-weight: 600;
        }

        /* 功能图标提示框 */
        .nav-icon[data-tooltip]:hover::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--color-dark);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }

        /* 图片上传系统样式 */
        .image-upload-btn:hover {
          background: rgba(37, 211, 102, 1) !important;
          transform: scale(1.05);
        }

        @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }

        .upload-notification.error {
          background: #dc3545 !important;
        }

        /* 图片懒加载占位符 */
        img[loading="lazy"] {
          background: var(--placeholder-color, #f0f0f0);
          opacity: 0;
          transition: opacity 0.3s ease;
        }

        img[loading="lazy"].loaded {
          opacity: 1;
        }

        /* 响应式图片优化 */
        .hero-banner .img img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: transform 0.3s ease;
        }

        .hero-banner .img img:hover {
          transform: scale(1.02);
        }

        /* 图片SEO优化 */
        .visually-hidden {
          position: absolute;
          width: 1px;
          height: 1px;
          padding: 0;
          margin: -1px;
          overflow: hidden;
          clip: rect(0, 0, 0, 0);
          white-space: nowrap;
          border: 0;
        }

        /* ========== CCPM规范页眉样式系统 ========== */

        /* 页眉容器 */
        .ccpm-header {
            background: var(--header-bg, #ffffff);
            border-bottom: var(--header-border-width, 1px) solid var(--header-border, var(--color-border));
            position: sticky;
            top: 0;
            z-index: var(--header-z-index, 100);
            height: var(--header-height-mobile, 56px);
            transition: all 0.3s ease;
        }

        /* 页眉主容器 */
        .ccpm-header__container {
            max-width: var(--header-max-width, 1200px);
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100%;
            padding: var(--header-padding-mobile, 8px 12px);
        }

        /* 品牌区域 */
        .ccpm-header__brand {
            display: flex;
            align-items: center;
            gap: var(--header-brand-gap, 12px);
            flex: 1 1 auto;
            min-width: 0;
            max-width: 70%;
        }

        /* Logo样式 */
        .ccpm-header__logo {
            flex-shrink: 0;
            width: var(--header-logo-size-mobile, 32px);
            height: var(--header-logo-size-mobile, 32px);
        }

        .ccpm-header__logo-icon {
            width: 100%;
            height: 100%;
            background: var(--whatsapp-green, #25D366);
            border-radius: var(--header-logo-radius, 8px);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--header-logo-font-size-mobile, 18px);
            transition: transform 0.2s ease;
        }

        .ccpm-header__logo-icon:hover {
            transform: scale(1.05);
        }

        .ccpm-header__logo-icon i {
            font-size: inherit;
            color: inherit;
        }

        /* 品牌标题 */
        .ccpm-header__title {
            font-weight: var(--header-title-weight, 600);
            font-size: var(--header-title-size-mobile, 16px);
            color: var(--header-title-color, var(--color-text));
            white-space: nowrap;
            overflow: visible;
            text-overflow: clip;
            line-height: 1.2;
            min-width: 0;
            flex: 1 1 auto;
        }

        /* 操作区域 */
        .ccpm-header__actions {
            display: flex;
            align-items: center;
            gap: var(--header-actions-gap, 12px);
            flex: 0 1 var(--header-actions-ratio, 40%);
            justify-content: flex-end;
        }

        /* 用户信息显示 */
        .ccpm-header__user {
            display: none;
            font-size: var(--header-user-font-size, 14px);
            color: var(--header-user-color, var(--color-muted));
        }

        .ccpm-header__username {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100px;
        }

        /* 移动端菜单按钮 */
        .ccpm-header__menu-toggle {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: var(--header-menu-size, 40px);
            height: var(--header-menu-size, 40px);
            background: transparent;
            border: 2px solid var(--header-menu-border, var(--color-border));
            border-radius: var(--header-menu-radius, 8px);
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0;
            flex-shrink: 0;
        }

        .ccpm-header__menu-toggle:hover {
            background: var(--header-menu-hover-bg, var(--color-hover));
            border-color: var(--header-menu-hover-border, var(--color-primary));
        }

        .ccpm-header__menu-toggle:active {
            transform: scale(0.95);
        }

        .ccpm-header__menu-icon {
            display: block;
            width: 20px;
            height: 2px;
            background: var(--header-menu-icon-color, var(--color-text));
            border-radius: 1px;
            position: relative;
            transition: all 0.3s ease;
        }

        .ccpm-header__menu-icon::before,
        .ccpm-header__menu-icon::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: inherit;
            border-radius: inherit;
            transition: all 0.3s ease;
        }

        .ccpm-header__menu-icon::before {
            top: -6px;
        }

        .ccpm-header__menu-icon::after {
            top: 6px;
        }

        .ccpm-header__menu-toggle[aria-expanded="true"] .ccpm-header__menu-icon {
            background: transparent;
        }

        .ccpm-header__menu-toggle[aria-expanded="true"] .ccpm-header__menu-icon::before {
            top: 0;
            transform: rotate(45deg);
        }

        .ccpm-header__menu-toggle[aria-expanded="true"] .ccpm-header__menu-icon::after {
            top: 0;
            transform: rotate(-45deg);
        }

        /* 桌面端操作区域 */
        .ccpm-header__desktop-actions {
            display: none;
            gap: var(--header-desktop-actions-gap, 8px);
        }

        .ccpm-header__action-btn {
            padding: var(--header-action-padding, 8px 16px);
            border-radius: var(--header-action-radius, 6px);
            border: 1px solid var(--header-action-border, var(--color-border));
            background: var(--header-action-bg, transparent);
            color: var(--header-action-color, var(--color-text));
            font-size: var(--header-action-font-size, 14px);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .ccpm-header__action-btn:hover {
            background: var(--header-action-hover-bg, var(--color-hover));
            border-color: var(--header-action-hover-border, var(--color-primary));
            color: var(--header-action-hover-color, var(--color-primary));
        }

        .ccpm-header__action-btn--primary {
            background: var(--whatsapp-green, #25D366);
            border-color: var(--whatsapp-green, #25D366);
            color: white;
        }

        .ccpm-header__action-btn--primary:hover {
            background: var(--whatsapp-green-dark, #20BA55);
            border-color: var(--whatsapp-green-dark, #20BA55);
            color: white;
        }

        /* 移动端折叠菜单 */
        .ccpm-header__mobile-menu {
            position: fixed;
            top: var(--header-height-mobile, 56px);
            left: 0;
            right: 0;
            background: var(--header-menu-bg, #ffffff);
            border-bottom: 1px solid var(--color-border);
            box-shadow: var(--header-menu-shadow, 0 2px 8px rgba(0,0,0,0.1));
            transform: translateY(-100%);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: var(--header-menu-z-index, 99);
            max-height: calc(100vh - var(--header-height-mobile, 56px));
            overflow-y: auto;
        }

        .ccpm-header__mobile-menu.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .ccpm-header__menu-content {
            padding: var(--header-menu-padding, 16px);
        }

        /* 菜单用户信息 */
        .ccpm-header__menu-user {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: var(--header-menu-user-padding, 12px);
            background: var(--header-menu-user-bg, var(--color-hover));
            border-radius: var(--header-menu-user-radius, 8px);
            margin-bottom: 16px;
        }

        .ccpm-header__menu-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--whatsapp-green, #25D366);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            flex-shrink: 0;
        }

        .ccpm-header__menu-user-details {
            flex: 1;
            min-width: 0;
        }

        .ccpm-header__menu-username {
            font-weight: 600;
            font-size: 16px;
            color: var(--color-text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ccpm-header__menu-user-id {
            font-size: 12px;
            color: var(--color-muted);
            margin-top: 2px;
        }

        /* 导航项目 */
        .ccpm-header__nav-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .ccpm-header__nav-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--color-hover);
            border-radius: 8px;
            text-decoration: none;
            color: var(--color-text);
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .ccpm-header__nav-item:hover {
            background: var(--color-primary);
            color: white;
            transform: translateY(-1px);
        }

        .ccpm-header__nav-item i {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        /* 操作项目 */
        .ccpm-header__action-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }

        .ccpm-header__menu-action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: transparent;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-text);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .ccpm-header__menu-action-btn:hover {
            background: var(--color-hover);
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .ccpm-header__menu-action-btn--primary {
            background: var(--whatsapp-green, #25D366);
            border-color: var(--whatsapp-green, #25D366);
            color: white;
        }

        .ccpm-header__menu-action-btn--primary:hover {
            background: var(--whatsapp-green-dark, #20BA55);
            border-color: var(--whatsapp-green-dark, #20BA55);
            color: white;
        }

        .ccpm-header__menu-action-btn i {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        /* 语言切换 */
        .ccpm-header__language-switcher {
            display: flex;
            gap: 8px;
            padding-top: 12px;
            border-top: 1px solid var(--color-border);
        }

        .ccpm-header__lang-btn {
            flex: 1;
            padding: 8px 12px;
            background: transparent;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .ccpm-header__lang-btn:hover {
            background: var(--color-hover);
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .ccpm-header__lang-btn.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }

        /* ========== 响应式设计 ========== */

        /* 平板端适配 */
        @media (min-width: 768px) {
            .ccpm-header {
                height: var(--header-height-tablet, 64px);
            }

            .ccpm-header__container {
                padding: var(--header-padding-tablet, 12px 20px);
            }

            .ccpm-header__logo {
                width: var(--header-logo-size-tablet, 40px);
                height: var(--header-logo-size-tablet, 40px);
            }

            .ccpm-header__logo-icon {
                font-size: var(--header-logo-font-size-tablet, 22px);
            }

            .ccpm-header__title {
                font-size: var(--header-title-size-tablet, 18px);
            }

            .ccpm-header__mobile-menu {
                top: var(--header-height-tablet, 64px);
                max-height: calc(100vh - var(--header-height-tablet, 64px));
            }

            .ccpm-header__nav-items {
                grid-template-columns: repeat(4, 1fr);
                gap: 12px;
            }
        }

        /* 桌面端适配 */
        @media (min-width: 1024px) {
            .ccpm-header {
                height: var(--header-height-desktop, 72px);
            }

            .ccpm-header__container {
                padding: var(--header-padding-desktop, 16px 24px);
            }

            .ccpm-header__logo {
                width: var(--header-logo-size-desktop, 48px);
                height: var(--header-logo-size-desktop, 48px);
            }

            .ccpm-header__logo-icon {
                font-size: var(--header-logo-font-size-desktop, 26px);
            }

            .ccpm-header__title {
                font-size: var(--header-title-size-desktop, 20px);
            }

            .ccpm-header__menu-toggle {
                display: none;
            }

            .ccpm-header__desktop-actions {
                display: flex;
            }

            .ccpm-header__user {
                display: block;
            }

            .ccpm-header__mobile-menu {
                display: none;
            }
        }

        /* 兼容性别名 - 保持向后兼容 */
        .header {
            background: var(--header-bg, #ffffff);
            border-bottom: var(--header-border-width, 1px) solid var(--header-border, var(--color-border));
        }

        .nav-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--color-hover);
            border: none;
            color: var(--color-text);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- CCPM规范的页眉结构 -->
    <header role="banner" class="ccpm-header" data-config="header.layout">
        <div class="ccpm-header__container" data-config="header.responsive">
            <!-- Logo和品牌区域 -->
            <div class="ccpm-header__brand" data-config="header.brand">
                <!-- WhatsApp Logo -->
                <div class="ccpm-header__logo" data-config="header.logo">
                    <div class="ccpm-header__logo-icon" aria-hidden="true">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                </div>
                <!-- 品牌标题 -->
                <div class="ccpm-header__title" data-i18n="whatsapp_official_lottery_tool" data-config="header.title">
                    WhatsApp官方抽奖工具
                </div>
            </div>

            <!-- 右侧操作区域 -->
            <div class="ccpm-header__actions" data-config="header.actions">
                <!-- 用户信息显示 -->
                <div class="ccpm-header__user" id="user-info" style="display: none;">
                    <span class="ccpm-header__username" id="username-display"></span>
                </div>

                <!-- 移动端菜单按钮 -->
                <button class="ccpm-header__menu-toggle"
                        id="mobile-menu-toggle"
                        aria-label="打开菜单"
                        aria-expanded="false"
                        aria-controls="mobile-menu">
                    <span class="ccpm-header__menu-icon"></span>
                </button>

                <!-- 桌面端快速操作 -->
                <div class="ccpm-header__desktop-actions">
                    <button class="ccpm-header__action-btn ccpm-header__action-btn--primary"
                            id="create-activity-btn"
                            data-i18n="create_activity">
                        创建活动
                    </button>
                    <button class="ccpm-header__action-btn"
                            id="view-stats-btn"
                            data-i18n="view_statistics">
                        查看统计
                    </button>
                </div>
            </div>
        </div>

        <!-- 移动端折叠菜单 -->
        <nav class="ccpm-header__mobile-menu"
             id="mobile-menu"
             role="navigation"
             aria-label="主导航">
            <div class="ccpm-header__menu-content">
                <!-- 用户信息区域 -->
                <div class="ccpm-header__menu-user" id="menu-user-info">
                    <div class="ccpm-header__menu-avatar" id="user-avatar-placeholder"></div>
                    <div class="ccpm-header__menu-user-details">
                        <div class="ccpm-header__menu-username" id="menu-username"></div>
                        <div class="ccpm-header__menu-user-id" id="menu-user-id"></div>
                    </div>
                </div>

                <!-- 主要导航项目 -->
                <div class="ccpm-header__nav-items">
                    <a href="#" class="ccpm-header__nav-item" data-page="home" data-i18n="home">
                        <i class="fas fa-home"></i>
                        <span>首页</span>
                    </a>
                    <a href="#" class="ccpm-header__nav-item" data-page="activities" data-i18n="my_activities">
                        <i class="fas fa-gift"></i>
                        <span>我的活动</span>
                    </a>
                    <a href="#" class="ccpm-header__nav-item" data-page="history" data-i18n="history">
                        <i class="fas fa-history"></i>
                        <span>历史记录</span>
                    </a>
                    <a href="#" class="ccpm-header__nav-item" data-page="profile" data-i18n="profile">
                        <i class="fas fa-user"></i>
                        <span>个人中心</span>
                    </a>
                </div>

                <!-- 功能操作项目 -->
                <div class="ccpm-header__action-items">
                    <button class="ccpm-header__menu-action-btn ccpm-header__menu-action-btn--primary"
                            data-action="create"
                            data-i18n="create_activity">
                        <i class="fas fa-plus"></i>
                        创建活动
                    </button>
                    <button class="ccpm-header__menu-action-btn"
                            data-action="stats"
                            data-i18n="view_statistics">
                        <i class="fas fa-chart-bar"></i>
                        查看统计
                    </button>
                    <button class="ccpm-header__menu-action-btn"
                            data-action="settings"
                            data-i18n="settings">
                        <i class="fas fa-cog"></i>
                        设置
                    </button>
                </div>

                <!-- 语言切换 -->
                <div class="ccpm-header__language-switcher">
                    <button class="ccpm-header__lang-btn" data-lang="zh">中文</button>
                    <button class="ccpm-header__lang-btn" data-lang="es">Español</button>
                    <button class="ccpm-header__lang-btn" data-lang="en">English</button>
                </div>
            </div>
        </nav>
    </header>

    <main class="container" role="main">
        <!-- Hero Section - 对齐参考文件结构 -->
        <section class="card card-hero" aria-labelledby="sec-hero">
            <div class="card-body">
                <div class="hero-banner" role="img" aria-label="奖品展示">
                    <div class="img">
                        <picture>
                            <!-- WebP 格式 - 现代浏览器 -->
                            <source
                                srcset="
                                    https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=375&h=211&fit=crop&crop=center&auto=format&fm=webp 375w,
                                    https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=768&h=432&fit=crop&crop=center&auto=format&fm=webp 768w,
                                    https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=1024&h=576&fit=crop&crop=center&auto=format&fm=webp 1024w,
                                    https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=1920&h=1080&fit=crop&crop=center&auto=format&fm=webp 1920w
                                "
                                sizes="(max-width: 768px) 375px, (max-width: 1024px) 768px, 1024px"
                                type="image/webp"
                            >
                            <!-- JPEG 格式 - 降级支持 -->
                            <source
                                srcset="
                                    https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=375&h=211&fit=crop&crop=center&auto=format&fm=jpg 375w,
                                    https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=768&h=432&fit=crop&crop=center&auto=format&fm=jpg 768w,
                                    https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=1024&h=576&fit=crop&crop=center&auto=format&fm=jpg 1024w,
                                    https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=1920&h=1080&fit=crop&crop=center&auto=format&fm=jpg 1920w
                                "
                                sizes="(max-width: 768px) 375px, (max-width: 1024px) 768px, 1024px"
                                type="image/jpeg"
                            >
                            <!-- 默认图片 -->
                            <img
                                src="https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=680&h=360&fit=crop&crop=center&auto=format"
                                srcset="
                                    https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=375&h=211&fit=crop&crop=center&auto=format 375w,
                                    https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=768&h=432&fit=crop&crop=center&auto=format 768w,
                                    https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=1024&h=576&fit=crop&crop=center&auto=format 1024w,
                                    https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=1920&h=1080&fit=crop&crop=center&auto=format 1920w
                                "
                                sizes="(max-width: 768px) 375px, (max-width: 1024px) 768px, 1024px"
                                alt="iPhone 15 Pro 奖品图片"
                                loading="lazy"
                                data-responsive="true"
                                data-image-type="banner"
                                width="680"
                                height="360"
                                style="width: 100%; height: 100%; object-fit: cover; border-radius: var(--radius-lg);">
                        </picture>
                    </div>
                    <div class="ticker" role="status" aria-live="polite" aria-label="最新活动" title="最新活动">
                        <div class="ticker-track">
                            <span><span class="avatar-sm" aria-hidden="true"></span> 小明刚刚参与抽奖</span>
                            <span><span class="avatar-sm" aria-hidden="true"></span> 小红完成WhatsApp验证</span>
                            <span><span class="avatar-sm" aria-hidden="true"></span> 小华邀请了3位好友</span>
                            <span><span class="avatar-sm" aria-hidden="true"></span> 小李获得额外抽奖机会</span>
                            <span><span class="avatar-sm" aria-hidden="true"></span> 小明刚刚参与抽奖</span>
                            <span><span class="avatar-sm" aria-hidden="true"></span> 小红完成WhatsApp验证</span>
                            <span><span class="avatar-sm" aria-hidden="true"></span> 小华邀请了3位好友</span>
                        </div>
                    </div>
                </div>
                <div class="hero-meta">
                    <div class="meta-left">
                        <div class="meta-title">本周大奖：iPhone 15 Pro</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Countdown Section - 对齐参考文件结构 -->
        <section class="card" id="countdown-card" aria-label="倒计时">
            <div class="card-body">
                <div class="countdown-grid" aria-live="polite">
                    <div class="cd-box"><span class="cd-number" id="cd-day">02</span><span class="cd-label">天</span></div>
                    <div class="cd-box"><span class="cd-number" id="cd-hour">14</span><span class="cd-label">小时</span></div>
                    <div class="cd-box"><span class="cd-number" id="cd-minute">30</span><span class="cd-label">分</span></div>
                    <div class="cd-box"><span class="cd-number" id="cd-second">45</span><span class="cd-label">秒</span></div>
                </div>
                <div class="end-time-center" id="cd-end">活动结束时间：2025-10-01 18:00</div>
            </div>
        </section>

        <!-- Sponsor Section - 对齐参考文件结构 -->
        <section class="card" aria-labelledby="sec-sponsor">
            <div class="card-body sponsor">
                <div class="sponsor-left">
                    <div class="logo" role="img" aria-label="WhatsApp官方抽奖工具 Logo">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                    <div>
                        <div style="font-weight:600" data-i18n="whatsapp_official_lottery_tool">WhatsApp官方抽奖工具</div>
                        <div style="color:var(--color-muted); font-size: 12px;" data-i18n="sponsor.official">官方赞助商</div>
                    </div>
                </div>
                <div style="display: flex; flex-direction: column; gap: 8px; align-items: flex-end;">
                    <a href="https://business.whatsapp.com/"
                       target="_blank"
                       rel="noopener noreferrer"
                       data-i18n="sponsor.view"
                       style="background: var(--color-primary);
                              color: var(--color-white);
                              padding: 6px 12px;
                              border-radius: 999px;
                              font-size: 12px;
                              font-weight: 600;
                              display: inline-flex;
                              align-items: center;
                              gap: 4px;
                              text-decoration: none;
                              transition: background-color 0.15s ease;"
                       onmouseover="this.style.backgroundColor='var(--color-primary-dark)'"
                       onmouseout="this.style.backgroundColor='var(--color-primary)'">
                        <i class="fas fa-external-link-alt"></i>
                        <span data-i18n="sponsor.view">查看</span>
                    </a>
                    <div style="display: flex; align-items: center; gap: 4px; color: var(--color-primary); font-size: 11px;">
                        <i class="fas fa-check-circle" style="font-size: 10px;"></i>
                        <span data-i18n="sponsor.verified">已验证赞助商</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Description Section - 对齐参考文件结构 -->
        <section class="card" aria-labelledby="sec-desc">
            <div class="card-body">
                <div style="font-weight: 600; margin-bottom: 8px;">活动说明</div>
                <div class="list" aria-label="活动详情">
                    <div>✅ 验证WhatsApp账号即可获得抽奖机会</div>
                    <div>✅ 邀请好友可获得更多抽奖机会</div>
                    <div>✅ 奖品真实有效，公开透明抽奖</div>
                    <div>✅ 中奖后将通过WhatsApp通知</div>
                </div>
            </div>
        </section>

        <!-- CTA Section - 对齐参考文件结构 -->
        <section aria-label="行动召唤" class="cta-wrap">
            <div class="cta-hint" aria-live="polite">验证成功，立即参与抽奖！</div>
            <div class="cta-cost-text" data-i18n="cta.cost" style="text-align: center; margin-bottom: 8px; font-size: 14px; color: var(--color-muted);">消耗1次机会</div>
            <button class="btn-cta-round" type="button" aria-label="参与抽奖">
                <span class="main-text">立即抽奖</span>
            </button>
            <div style="display:flex; align-items:center; gap: 12px;">
                <div class="avatars" aria-hidden="true">
                    <div class="avatar"></div>
                    <div class="avatar"></div>
                    <div class="avatar"></div>
                    <div class="avatar"></div>
                    <div class="avatar"></div>
                </div>
                <div class="cta-sub"><strong style="color:var(--color-text)">18,975</strong> 人正在参与</div>
            </div>
            <div class="cta-sub">已有 <strong>1,234</strong> 人获得奖品</div>
        </section>

        <!-- WhatsApp官方风格简化页脚 -->
        <footer role="contentinfo" style="background: #f8f9fa; padding: 32px 0 24px; margin-top: 48px;">
            <div class="container">
                <div style="text-align: center; display: flex; flex-direction: column; align-items: center; gap: 20px;">
                    <!-- 品牌名称 -->
                    <div style="font-size: 18px; font-weight: 600; color: var(--color-text);" data-i18n="whatsapp_official_lottery_tool">
                        WhatsApp官方抽奖工具
                    </div>

                    <!-- 核心链接 -->
                    <div style="display: flex; gap: 24px; flex-wrap: wrap; justify-content: center;">
                        <a href="#" style="color: var(--color-muted); text-decoration: none; font-size: 14px;" data-i18n="footer.terms">服务条款</a>
                        <a href="#" style="color: var(--color-muted); text-decoration: none; font-size: 14px;" data-i18n="footer.privacy">隐私政策</a>
                        <a href="#" style="color: var(--color-muted); text-decoration: none; font-size: 14px;" data-i18n="footer.sitemap">网站地图</a>
                        <a href="#" style="color: var(--color-muted); text-decoration: none; font-size: 14px;" data-i18n="footer.cookies">Cookie政策</a>
                    </div>

                    <!-- 社交媒体图标 -->
                    <div style="display: flex; gap: 16px; justify-content: center;">
                        <a href="#" style="color: var(--color-muted); font-size: 18px; text-decoration: none;" aria-label="Twitter">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/>
                            </svg>
                        </a>
                        <a href="#" style="color: var(--color-muted); font-size: 18px; text-decoration: none;" aria-label="YouTube">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
                            </svg>
                        </a>
                        <a href="#" style="color: var(--color-muted); font-size: 18px; text-decoration: none;" aria-label="Instagram">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
                                <path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z" fill="none"/>
                                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </a>
                        <a href="#" style="color: var(--color-muted); font-size: 18px; text-decoration: none;" aria-label="Facebook">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/>
                            </svg>
                        </a>
                    </div>

                    <!-- 版权信息 -->
                    <div style="color: var(--color-muted); font-size: 12px; text-align: center; border-top: 1px solid var(--color-border); padding-top: 16px; width: 100%;">
                        <div data-i18n="footer.copyright">© 2025 WhatsApp LLC. 保留所有权利。</div>
                    </div>
                </div>
            </div>
        </footer>
    </main>

    <!-- Sticky CTA - 对齐参考文件结构 -->
    <div class="sticky-cta" id="sticky-cta" role="region" aria-label="固定操作按钮">
        <div style="font-weight:600">准备抽奖？</div>
        <button class="btn-cta-round" type="button" aria-label="立即抽奖">
            <i class="fas fa-dice"></i>
        </button>
    </div>

    <script>
        // 用户状态管理和功能图标交互系统
        const UserState = {
            // 用户状态: 'unauthenticated' | 'authenticated'
            currentState: 'unauthenticated',
            userData: null,

            // 初始化用户状态
            init() {
                this.checkAuthStatus();
                this.bindEvents();
                this.updateNavigation();
            },

            // 检查用户登录状态（模拟API调用）
            async checkAuthStatus() {
                // 模拟API调用 - 实际项目中应该调用真实API
                try {
                    // const response = await fetch('/api/user/status');
                    // const data = await response.json();
                    // this.currentState = data.authenticated ? 'authenticated' : 'unauthenticated';
                    // this.userData = data.user;

                    // 演示模式：默认未登录
                    this.currentState = 'unauthenticated';
                    this.userData = null;
                } catch (error) {
                    console.error('检查用户状态失败:', error);
                    this.currentState = 'unauthenticated';
                }
                this.updateNavigation();
            },

            // 绑定事件
            bindEvents() {
                // 功能图标点击事件
                document.querySelectorAll('.nav-icon').forEach(icon => {
                    icon.addEventListener('click', (e) => {
                        this.handleIconClick(e);
                    });
                });

                // 模拟登录切换（演示用）
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'l') {
                        e.preventDefault();
                        this.toggleLoginStatus();
                    }
                });
            },

            // 处理功能图标点击
            handleIconClick(event) {
                const icon = event.currentTarget;
                const modalType = icon.dataset.modal;

                if (!modalType) return;

                // 检查权限
                if (icon.classList.contains('authenticated-only') && this.currentState !== 'authenticated') {
                    this.showLoginPrompt();
                    return;
                }

                // 打开对应弹窗
                this.openModal(modalType);
            },

            // 显示登录提示
            showLoginPrompt() {
                const message = document.createElement('div');
                message.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: var(--color-dark);
                    color: white;
                    padding: 16px 24px;
                    border-radius: 8px;
                    z-index: 10000;
                    font-size: 14px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                `;
                message.textContent = '请先登录后使用此功能';
                document.body.appendChild(message);

                setTimeout(() => {
                    message.remove();
                }, 2000);
            },

            // 打开弹窗（基于PRD弹窗系统）
            openModal(modalType) {
                const modalConfigs = {
                    rules: {
                        title: '规则说明',
                        content: '这里是活动规则、参与方式、奖品说明等详细信息'
                    },
                    'winner-history': {
                        title: '中奖记录',
                        content: '这里是个人中奖历史记录'
                    },
                    'invite-history': {
                        title: '邀请记录',
                        content: '这里是邀请好友记录和奖励状态'
                    },
                    support: {
                        title: '客服支持',
                        content: '这里是帮助中心、常见问题、联系客服等信息'
                    }
                };

                const config = modalConfigs[modalType];
                if (!config) return;

                this.createModal(config);
            },

            // 创建弹窗
            createModal(config) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    backdrop-filter: blur(4px);
                `;

                modal.innerHTML = `
                    <div style="background: white; border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3 style="margin: 0; color: var(--color-text);">${config.title}</h3>
                            <button onclick="this.closest('[role=dialog]').remove()" style="background: none; border: none; font-size: 20px; color: var(--color-muted); cursor: pointer;">×</button>
                        </div>
                        <div style="color: var(--color-text); line-height: 1.6;">
                            ${config.content}
                        </div>
                        <div style="margin-top: 20px; text-align: right;">
                            <button onclick="this.closest('[role=dialog]').remove()" style="background: var(--color-primary); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">关闭</button>
                        </div>
                    </div>
                `;
                modal.setAttribute('role', 'dialog');
                modal.setAttribute('aria-modal', 'true');

                // 点击背景关闭
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });

                document.body.appendChild(modal);
            },

            // 更新导航显示
            updateNavigation() {
                const authenticatedIcons = document.querySelectorAll('.nav-icon.authenticated-only');
                const userAvatar = document.querySelector('.user-avatar');
                const userStatusText = document.querySelector('.user-status-text');

                if (this.currentState === 'authenticated') {
                    // 已登录状态
                    authenticatedIcons.forEach(icon => {
                        icon.classList.remove('authenticated-only');
                        icon.classList.add('authenticated');
                        icon.style.cursor = 'pointer';
                    });

                    userAvatar.classList.add('authenticated');
                    userStatusText.textContent = '已登录';
                    userStatusText.classList.add('authenticated');
                } else {
                    // 未登录状态
                    authenticatedIcons.forEach(icon => {
                        icon.classList.add('authenticated-only');
                        icon.classList.remove('authenticated');
                        icon.style.cursor = 'not-allowed';
                    });

                    userAvatar.classList.remove('authenticated');
                    userStatusText.textContent = '未登录';
                    userStatusText.classList.remove('authenticated');
                }
            },

            // 切换登录状态（演示用）
            toggleLoginStatus() {
                if (this.currentState === 'authenticated') {
                    this.currentState = 'unauthenticated';
                    this.userData = null;
                } else {
                    this.currentState = 'authenticated';
                    this.userData = { name: '演示用户', id: 'demo_user_001' };
                }
                this.updateNavigation();

                // 显示状态切换提示
                const message = document.createElement('div');
                message.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--color-primary);
                    color: white;
                    padding: 12px 16px;
                    border-radius: 6px;
                    z-index: 10000;
                    font-size: 14px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                `;
                message.textContent = `已切换为${this.currentState === 'authenticated' ? '已登录' : '未登录'}状态 (Ctrl+L 切换)`;
                document.body.appendChild(message);

                setTimeout(() => {
                    message.remove();
                }, 2000);
            }
        };

        // ========== CCPM规范页眉管理系统 ==========

        const CcpmHeaderManager = {
            // 配置系统 - 集成HomeConfig设计令牌
            config: {
                // 从HomeConfig读取的配置会在这里自动合并
                layout: {
                    type: 'mobile-first',
                    maxWidth: '1200px',
                    breakpoints: {
                        mobile: '375px',
                        tablet: '768px',
                        desktop: '1024px'
                    }
                },
                menu: {
                    animationDuration: 300,
                    overlay: true,
                    closeOnOutsideClick: true,
                    closeOnEsc: true
                },
                user: {
                    showAvatar: true,
                    showUsername: true,
                    maxUsernameLength: 12
                },
                accessibility: {
                    ariaLabels: {
                        menuToggle: '打开菜单',
                        closeMenu: '关闭菜单',
                        userMenu: '用户菜单'
                    }
                }
            },

            // 状态管理
            state: {
                isMenuOpen: false,
                currentUser: null,
                currentLanguage: 'zh-CN',
                isMobile: false,
                viewportWidth: window.innerWidth
            },

            // DOM元素引用
            elements: {},

            // 初始化系统
            init() {
                this.cacheElements();
                this.bindEvents();
                this.checkViewport();
                this.loadUserState();
                this.initializeAccessibility();
                this.setupConfigurationDriven();

                if (this.global.debugMode) {
                    console.log('CCPM Header Manager initialized:', this.state);
                }
            },

            // 缓存DOM元素
            cacheElements() {
                this.elements = {
                    header: document.querySelector('.ccpm-header'),
                    container: document.querySelector('.ccpm-header__container'),
                    menuToggle: document.getElementById('mobile-menu-toggle'),
                    mobileMenu: document.getElementById('mobile-menu'),
                    userInfo: document.getElementById('user-info'),
                    usernameDisplay: document.getElementById('username-display'),
                    menuUserInfo: document.getElementById('menu-user-info'),
                    menuUsername: document.getElementById('menu-username'),
                    menuUserId: document.getElementById('menu-user-id'),
                    menuAvatar: document.getElementById('user-avatar-placeholder'),
                    navItems: document.querySelectorAll('.ccpm-header__nav-item'),
                    actionBtns: document.querySelectorAll('.ccpm-header__action-btn'),
                    langBtns: document.querySelectorAll('.ccpm-header__lang-btn'),
                    desktopActions: document.querySelector('.ccpm-header__desktop-actions')
                };

                // 验证必要的元素
                if (!this.elements.header) {
                    console.warn('CCPM Header: Header element not found');
                }
            },

            // 绑定事件监听器
            bindEvents() {
                // 菜单切换事件
                if (this.elements.menuToggle) {
                    this.elements.menuToggle.addEventListener('click', () => {
                        this.toggleMenu();
                    });
                }

                // 导航项目点击事件
                this.elements.navItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.handleNavigation(item.dataset.page);
                    });
                });

                // 操作按钮事件
                this.elements.actionBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.handleAction(btn.dataset.action || btn.id);
                    });
                });

                // 语言切换事件
                this.elements.langBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.switchLanguage(btn.dataset.lang);
                    });
                });

                // 窗口大小改变事件
                window.addEventListener('resize', this.debounce(() => {
                    this.checkViewport();
                }, 250));

                // 点击外部关闭菜单
                document.addEventListener('click', (e) => {
                    if (this.config.menu.closeOnOutsideClick && this.state.isMenuOpen) {
                        if (!this.elements.header.contains(e.target)) {
                            this.closeMenu();
                        }
                    }
                });

                // ESC键关闭菜单
                document.addEventListener('keydown', (e) => {
                    if (this.config.menu.closeOnEsc && e.key === 'Escape' && this.state.isMenuOpen) {
                        this.closeMenu();
                    }
                });

                // 监听语言变化事件
                document.addEventListener('header:language-changed', (event) => {
                    const newLanguage = event.detail.language;
                    // 更新CTA消耗文本
                    this.updateCTACostText(newLanguage);
                });
            },

            // 检查视口大小
            checkViewport() {
                const width = window.innerWidth;
                const wasMobile = this.state.isMobile;

                this.state.isMobile = width < 768;
                this.state.viewportWidth = width;

                // 如果移动状态改变，更新UI
                if (wasMobile !== this.state.isMobile) {
                    this.updateResponsiveLayout();
                }

                // 更新设计令牌
                this.updateDesignTokens();
            },

            // 更新响应式布局
            updateResponsiveLayout() {
                if (this.state.isMobile) {
                    // 移动端布局
                    this.elements.desktopActions.style.display = 'none';
                    this.elements.menuToggle.style.display = 'flex';
                } else {
                    // 桌面端布局
                    this.elements.desktopActions.style.display = 'flex';
                    this.elements.menuToggle.style.display = 'none';
                    this.closeMenu(); // 确保菜单关闭
                }
            },

            // 更新设计令牌
            updateDesignTokens() {
                const root = document.documentElement;
                const config = this.config.layout;

                // 根据视口大小设置CSS变量
                if (this.state.isMobile) {
                    root.style.setProperty('--header-height', 'var(--header-height-mobile, 56px)');
                    root.style.setProperty('--header-logo-size', 'var(--header-logo-size-mobile, 32px)');
                    root.style.setProperty('--header-title-size', 'var(--header-title-size-mobile, 16px)');
                    root.style.setProperty('--header-padding', 'var(--header-padding-mobile, 8px 12px)');
                } else if (this.state.viewportWidth >= 1024) {
                    root.style.setProperty('--header-height', 'var(--header-height-desktop, 72px)');
                    root.style.setProperty('--header-logo-size', 'var(--header-logo-size-desktop, 48px)');
                    root.style.setProperty('--header-title-size', 'var(--header-title-size-desktop, 20px)');
                    root.style.setProperty('--header-padding', 'var(--header-padding-desktop, 16px 24px)');
                } else {
                    root.style.setProperty('--header-height', 'var(--header-height-tablet, 64px)');
                    root.style.setProperty('--header-logo-size', 'var(--header-logo-size-tablet, 40px)');
                    root.style.setProperty('--header-title-size', 'var(--header-title-size-tablet, 18px)');
                    root.style.setProperty('--header-padding', 'var(--header-padding-tablet, 12px 20px)');
                }
            },

            // 切换菜单状态
            toggleMenu() {
                if (this.state.isMenuOpen) {
                    this.closeMenu();
                } else {
                    this.openMenu();
                }
            },

            // 打开菜单
            openMenu() {
                this.state.isMenuOpen = true;

                if (this.elements.mobileMenu) {
                    this.elements.mobileMenu.classList.add('active');
                }

                if (this.elements.menuToggle) {
                    this.elements.menuToggle.setAttribute('aria-expanded', 'true');
                }

                // 防止背景滚动
                document.body.style.overflow = 'hidden';

                if (this.global.debugMode) {
                    console.log('CCPM Header: Menu opened');
                }
            },

            // 关闭菜单
            closeMenu() {
                this.state.isMenuOpen = false;

                if (this.elements.mobileMenu) {
                    this.elements.mobileMenu.classList.remove('active');
                }

                if (this.elements.menuToggle) {
                    this.elements.menuToggle.setAttribute('aria-expanded', 'false');
                }

                // 恢复背景滚动
                document.body.style.overflow = '';

                if (this.global.debugMode) {
                    console.log('CCPM Header: Menu closed');
                }
            },

            // 处理导航点击
            handleNavigation(page) {
                if (!page) return;

                // 关闭菜单
                this.closeMenu();

                // 处理页面导航
                switch (page) {
                    case 'home':
                        this.navigateToHome();
                        break;
                    case 'activities':
                        this.navigateToActivities();
                        break;
                    case 'history':
                        this.navigateToHistory();
                        break;
                    case 'profile':
                        this.navigateToProfile();
                        break;
                    default:
                        console.warn('Unknown navigation page:', page);
                }

                if (this.global.debugMode) {
                    console.log('CCPM Header: Navigated to:', page);
                }
            },

            // 处理操作按钮点击
            handleAction(action) {
                if (!action) return;

                switch (action) {
                    case 'create':
                    case 'create-activity-btn':
                        this.handleCreateActivity();
                        break;
                    case 'stats':
                    case 'view-stats-btn':
                        this.handleViewStats();
                        break;
                    case 'settings':
                        this.handleSettings();
                        break;
                    default:
                        console.warn('Unknown action:', action);
                }

                if (this.global.debugMode) {
                    console.log('CCPM Header: Action triggered:', action);
                }
            },

            // 创建活动
            handleCreateActivity() {
                // 检查用户权限
                if (!this.state.currentUser) {
                    this.showLoginPrompt('请先登录以创建活动');
                    return;
                }

                // 触发创建活动事件
                this.emitEvent('header:create-activity', {
                    user: this.state.currentUser
                });
            },

            // 查看统计
            handleViewStats() {
                this.emitEvent('header:view-stats', {
                    user: this.state.currentUser
                });
            },

            // 设置
            handleSettings() {
                this.emitEvent('header:settings', {
                    user: this.state.currentUser
                });
            },

            // 切换语言
            switchLanguage(lang) {
                if (!lang) return;

                // 更新按钮状态
                this.elements.langBtns.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.lang === lang);
                });

                // 更新状态
                this.state.currentLanguage = lang;

                // 触发语言切换事件
                this.emitEvent('header:language-changed', { language: lang });

                if (this.global.debugMode) {
                    console.log('CCPM Header: Language switched to:', lang);
                }
            },

            // 加载用户状态
            loadUserState() {
                // 与UserState集成
                if (window.UserState) {
                    this.state.currentUser = UserState.currentState === 'authenticated' ?
                        UserState.userData : null;
                    this.updateUserDisplay();
                }

                // 监听用户状态变化
                this.observeUserStateChanges();
            },

            // 监听用户状态变化
            observeUserStateChanges() {
                // 简单的状态轮询（实际项目中可以使用事件系统）
                setInterval(() => {
                    if (window.UserState) {
                        const newState = UserState.currentState === 'authenticated' ?
                            UserState.userData : null;

                        if (JSON.stringify(newState) !== JSON.stringify(this.state.currentUser)) {
                            this.state.currentUser = newState;
                            this.updateUserDisplay();
                        }
                    }
                }, 1000);
            },

            // 更新用户显示
            updateUserDisplay() {
                const isAuthenticated = !!this.state.currentUser;

                // 更新用户信息显示
                if (this.elements.userInfo) {
                    this.elements.userInfo.style.display = isAuthenticated ? 'block' : 'none';
                }

                if (this.elements.menuUserInfo) {
                    this.elements.menuUserInfo.style.display = isAuthenticated ? 'flex' : 'none';
                }

                if (this.elements.usernameDisplay && this.state.currentUser) {
                    this.elements.usernameDisplay.textContent =
                        this.truncateText(this.state.currentUser.name || '用户', this.config.user.maxUsernameLength);
                }

                if (this.elements.menuUsername && this.state.currentUser) {
                    this.elements.menuUsername.textContent = this.state.currentUser.name || '用户';
                }

                if (this.elements.menuUserId && this.state.currentUser) {
                    this.elements.menuUserId.textContent = `ID: ${this.state.currentUser.id || 'N/A'}`;
                }
            },

            // 初始化无障碍功能
            initializeAccessibility() {
                // 设置ARIA标签
                if (this.elements.menuToggle) {
                    this.elements.menuToggle.setAttribute('aria-label',
                        this.config.accessibility.ariaLabels.menuToggle);
                }

                if (this.elements.mobileMenu) {
                    this.elements.mobileMenu.setAttribute('aria-label',
                        this.config.accessibility.ariaLabels.userMenu);
                }

                // 键盘导航支持
                this.setupKeyboardNavigation();
            },

            // 设置键盘导航
            setupKeyboardNavigation() {
                // 为菜单项添加键盘导航
                this.elements.navItems.forEach((item, index) => {
                    item.setAttribute('tabindex', '0');
                    item.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            this.handleNavigation(item.dataset.page);
                        }
                    });
                });
            },

            // 设置配置驱动
            setupConfigurationDriven() {
                // 从HomeConfig读取配置
                if (window.HomeConfig && window.HomeConfig.header) {
                    this.mergeConfig(window.HomeConfig.header);
                }

                // 监听配置变化
                this.observeConfigChanges();
            },

            // 合并配置
            mergeConfig(newConfig) {
                this.config = this.deepMerge(this.config, newConfig);

                if (this.global.debugMode) {
                    console.log('CCPM Header: Configuration updated:', this.config);
                }
            },

            // 监听配置变化
            observeConfigChanges() {
                // 简单的配置变化监听（实际项目中可以使用更复杂的事件系统）
                setInterval(() => {
                    if (window.HomeConfig && window.HomeConfig.header) {
                        const currentConfig = JSON.stringify(window.HomeConfig.header);
                        if (this.lastConfigStr !== currentConfig) {
                            this.lastConfigStr = currentConfig;
                            this.mergeConfig(window.HomeConfig.header);
                        }
                    }
                }, 1000);
            },

            // 显示登录提示
            showLoginPrompt(message = '请先登录后使用此功能') {
                // 重用UserState的显示逻辑或创建新的提示
                if (window.UserState && window.UserState.showLoginPrompt) {
                    window.UserState.showLoginPrompt();
                } else {
                    this.showToast(message);
                }
            },

            // 显示提示消息
            showToast(message, duration = 2000) {
                const toast = document.createElement('div');
                toast.className = 'ccpm-header__toast';
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--color-primary);
                    color: white;
                    padding: 12px 16px;
                    border-radius: 6px;
                    z-index: 10000;
                    font-size: 14px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                `;

                document.body.appendChild(toast);

                // 动画显示
                setTimeout(() => {
                    toast.style.transform = 'translateX(0)';
                }, 10);

                // 自动移除
                setTimeout(() => {
                    toast.style.transform = 'translateX(100%)';
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            },

            // 触发事件
            emitEvent(eventName, data) {
                // 创建自定义事件
                const event = new CustomEvent(eventName, {
                    detail: data,
                    bubbles: true,
                    cancelable: true
                });

                // 触发事件
                document.dispatchEvent(event);

                if (this.global.debugMode) {
                    console.log('CCPM Header: Event emitted:', eventName, data);
                }
            },

            // 导航方法
            navigateToHome() {
                this.emitEvent('header:navigate', { page: 'home' });
            },

            navigateToActivities() {
                this.emitEvent('header:navigate', { page: 'activities' });
            },

            navigateToHistory() {
                this.emitEvent('header:navigate', { page: 'history' });
            },

            navigateToProfile() {
                this.emitEvent('header:navigate', { page: 'profile' });
            },

            // 工具方法：防抖
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            // 工具方法：截断文本
            truncateText(text, maxLength) {
                if (!text) return '';
                return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
            },

            // 工具方法：深度合并
            deepMerge(target, source) {
                const result = { ...target };

                for (const key in source) {
                    if (source[key] && typeof source[key] === 'object' && !Array.isArray(source[key])) {
                        result[key] = this.deepMerge(result[key] || {}, source[key]);
                    } else {
                        result[key] = source[key];
                    }
                }

                return result;
            },

            // 全局配置
            global: {
                debugMode: false // 可以通过HomeConfig配置
            }
        };

        // ========== 初始化CCPM页眉系统 ==========

        // 在DOM加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // 初始化CCPM Header Manager
                CcpmHeaderManager.init();

                // 与现有系统集成
                if (window.UserState) {
                    // 增强UserState的更新方法
                    const originalUpdate = UserState.updateNavigation;
                    UserState.updateNavigation = function() {
                        originalUpdate.call(this);
                        CcpmHeaderManager.loadUserState();
                    };
                }

                // 监听全局配置变化
                if (window.HomeConfig) {
                    window.HomeConfig.addEventListener && window.HomeConfig.addEventListener('change', (newConfig) => {
                        CcpmHeaderManager.mergeConfig(newConfig.header || {});
                    });
                }

                // 设置全局调试模式
                if (window.HomeConfig && window.HomeConfig.global) {
                    CcpmHeaderManager.global.debugMode = window.HomeConfig.global.debugMode || false;
                }

                if (CcpmHeaderManager.global.debugMode) {
                    console.log('CCPM Header System: Integration complete');
                }

            } catch (error) {
                console.error('CCPM Header System initialization failed:', error);
            }
        });

        // ========== 多语言跑马灯管理系统 ==========
        const TickerManager = {
            // 多语言消息模板
            messages: {
                'es-MX': {
                    user_joined: '{user} se unió hace {time}',
                    step_completed: '{user} completó el paso {step}',
                    friends_invited: '{user} invitó a {count} amigos',
                    prize_won: '{user} ganó {prize}',
                    whatsapp_verified: '{user} verificó WhatsApp',
                    got_extra_chance: '{user} obtuvo oportunidad extra',
                    activity_generic: 'Actividad reciente'
                },
                'en': {
                    user_joined: '{user} joined {time} ago',
                    step_completed: '{user} completed step {step}',
                    friends_invited: '{user} invited {count} friends',
                    prize_won: '{user} won {prize}',
                    whatsapp_verified: '{user} verified WhatsApp',
                    got_extra_chance: '{user} got extra chance',
                    activity_generic: 'Recent activity'
                },
                'zh-CN': {
                    user_joined: '{user}刚刚参与抽奖',
                    step_completed: '{user}完成WhatsApp验证',
                    friends_invited: '{user}邀请了{count}位好友',
                    prize_won: '{user}获得{prize}',
                    whatsapp_verified: '{user}验证了WhatsApp',
                    got_extra_chance: '{user}获得额外机会',
                    activity_generic: '最新活动'
                }
            },

            // 配置参数
            config: {
                currentLang: 'zh-CN', // 默认中文
                refreshInterval: 5000, // 5秒刷新
                maxMessages: 10, // 最多显示10条
                animationDuration: 18, // 滚动动画时长(秒)
                dataSource: 'realtime_api' // 数据来源类型
            },

            // 示例数据源（模拟实时数据）
            sampleDataSource: [
                { type: 'user_joined', user: '小明', time: '10s' },
                { type: 'step_completed', user: '小红', step: 'WhatsApp验证' },
                { type: 'friends_invited', user: '小华', count: 3 },
                { type: 'prize_won', user: '小李', prize: '额外机会' },
                { type: 'whatsapp_verified', user: '小王' },
                { type: 'got_extra_chance', user: '小张' }
            ],

            // 初始化
            init() {
                this.setupLanguageDetection();
                this.startRealtimeUpdates();
                this.setupUserInteraction();
                this.render();
            },

            // 设置语言检测
            setupLanguageDetection() {
                // 检测浏览器语言或用户设置
                const browserLang = navigator.language || 'zh-CN';
                const supportedLangs = Object.keys(this.messages);

                if (supportedLangs.includes(browserLang)) {
                    this.config.currentLang = browserLang;
                } else if (browserLang.startsWith('es')) {
                    this.config.currentLang = 'es-MX';
                } else if (browserLang.startsWith('en')) {
                    this.config.currentLang = 'en';
                } else {
                    this.config.currentLang = 'zh-CN';
                }

                console.log(`跑马灯语言设置为: ${this.config.currentLang}`);
            },

            // 开始实时更新
            startRealtimeUpdates() {
                // 模拟实时数据更新 - 实际项目应该使用WebSocket或API轮询
                setInterval(() => {
                    this.fetchNewMessages();
                }, this.config.refreshInterval);
            },

            // 获取新消息（模拟API调用）
            async fetchNewMessages() {
                try {
                    // 模拟API调用
                    // const response = await fetch('/api/ticker/messages');
                    // const data = await response.json();
                    // this.updateMessages(data);

                    // 演示模式：随机生成新消息
                    this.generateDemoMessage();
                } catch (error) {
                    console.error('获取跑马灯消息失败:', error);
                }
            },

            // 生成演示消息
            generateDemoMessage() {
                const messageTypes = Object.keys(this.messages[this.config.currentLang]).filter(key => key !== 'activity_generic');
                const randomType = messageTypes[Math.floor(Math.random() * messageTypes.length)];

                const userNames = ['小明', '小红', '小华', '小李', '小王', '小张', '小刘', '小陈'];
                const randomUser = userNames[Math.floor(Math.random() * userNames.length)];

                // 创建新消息并添加到数据源
                const newMessage = {
                    type: randomType,
                    user: randomUser,
                    timestamp: Date.now()
                };

                // 根据消息类型添加特定参数
                if (randomType === 'friends_invited') {
                    newMessage.count = Math.floor(Math.random() * 5) + 1;
                } else if (randomType === 'step_completed') {
                    newMessage.step = Math.floor(Math.random() * 3) + 1;
                } else if (randomType === 'prize_won') {
                    const prizes = ['iPhone 15', '额外机会', '优惠券', '积分'];
                    newMessage.prize = prizes[Math.floor(Math.random() * prizes.length)];
                }

                // 添加到数据源开头
                this.sampleDataSource.unshift(newMessage);

                // 保持最大消息数量限制
                if (this.sampleDataSource.length > this.config.maxMessages) {
                    this.sampleDataSource = this.sampleDataSource.slice(0, this.config.maxMessages);
                }

                this.render();
            },

            // 设置用户交互
            setupUserInteraction() {
                const ticker = document.querySelector('.ticker');
                if (!ticker) return;

                let pauseTimeout;
                const pause = () => {
                    ticker.classList.add('paused');
                    clearTimeout(pauseTimeout);
                };
                const resume = () => {
                    pauseTimeout = setTimeout(() => {
                        ticker.classList.remove('paused');
                    }, 800);
                };

                // 鼠标交互
                ticker.addEventListener('pointerdown', pause);
                ticker.addEventListener('pointerup', resume);
                ticker.addEventListener('pointerleave', resume);

                // 触摸交互优化
                ticker.addEventListener('touchstart', pause);
                ticker.addEventListener('touchend', resume);
            },

            // 渲染跑马灯内容
            render() {
                const tickerTrack = document.querySelector('.ticker-track');
                if (!tickerTrack) return;

                const currentLangMessages = this.messages[this.config.currentLang];
                const renderedMessages = this.sampleDataSource.slice(0, 6).map(item => {
                    let messageText = currentLangMessages[item.type] || currentLangMessages.activity_generic;

                    // 替换消息模板中的变量
                    messageText = messageText.replace('{user}', item.user || '用户');
                    messageText = messageText.replace('{time}', item.time || '刚刚');
                    messageText = messageText.replace('{step}', item.step || '1');
                    messageText = messageText.replace('{count}', item.count || '1');
                    messageText = messageText.replace('{prize}', item.prize || '奖品');

                    return `<span><span class="avatar-sm" aria-hidden="true"></span> ${messageText}</span>`;
                }).join('');

                // 更新DOM
                tickerTrack.innerHTML = renderedMessages + renderedMessages; // 重复一份用于无缝滚动

                // 更新ARIA标签
                const tickerElement = document.querySelector('.ticker');
                if (tickerElement) {
                    const ariaLabel = currentLangMessages.activity_generic;
                    tickerElement.setAttribute('aria-label', ariaLabel);
                    tickerElement.setAttribute('title', ariaLabel);
                }
            },

            // 切换语言（公开接口）
            switchLanguage(lang) {
                if (this.messages[lang]) {
                    this.config.currentLang = lang;
                    this.render();
                    console.log(`跑马灯语言已切换为: ${lang}`);
                } else {
                    console.warn(`不支持的语言: ${lang}`);
                }
            },

            // 获取当前语言（公开接口）
            getCurrentLanguage() {
                return this.config.currentLang;
            },

            // 手动添加消息（公开接口）
            addMessage(type, data = {}) {
                const message = { type, timestamp: Date.now(), ...data };
                this.sampleDataSource.unshift(message);
                if (this.sampleDataSource.length > this.config.maxMessages) {
                    this.sampleDataSource = this.sampleDataSource.slice(0, this.config.maxMessages);
                }
                this.render();
            }
        };

        // 主页组件配置化管理系统
        const HomeConfig = {
            // 全局配置
            global: {
                apiBaseUrl: '/api/v1',
                debugMode: true,
                defaultLanguage: 'zh-CN',
                supportedLanguages: ['zh-CN', 'en', 'es-MX']
            },

            // 图片上传管理系统
            imageUploadManager: {
                enabled: true,
                apiBaseUrl: '/api/images',
                maxFileSize: 2 * 1024 * 1024, // 2MB
                allowedFormats: ['image/jpeg', 'image/png', 'image/webp'],
                compression: {
                    enabled: true,
                    quality: 0.8,
                    maxWidth: 1920,
                    maxHeight: 1080
                },
                uploadEndpoints: {
                    banner: '/api/images/upload/banner',
                    sponsor: '/api/images/upload/sponsor',
                    avatar: '/api/images/upload/avatar',
                    general: '/api/images/upload/general'
                },
                cdnConfig: {
                    enabled: true,
                    baseUrl: 'https://cdn.example.com/images/',
                    cacheControl: 'public, max-age=31536000', // 1年
                    formats: {
                        webp: 'image/webp',
                        jpeg: 'image/jpeg',
                        png: 'image/png'
                    }
                }
            },

            // 图片响应式系统
            responsiveImages: {
                enabled: true,
                breakpoints: {
                    mobile: { max: 768, width: 375 },
                    tablet: { max: 1024, width: 768 },
                    desktop: { min: 1025, width: 1920 }
                },
                formats: {
                    modern: ['webp'],
                    fallback: ['jpeg', 'png']
                },
                sizes: {
                    banner: {
                        mobile: { width: 375, height: 211 },
                        tablet: { width: 768, height: 432 },
                        desktop: { width: 1920, height: 1080 }
                    },
                    thumbnail: {
                        mobile: { width: 100, height: 100 },
                        tablet: { width: 150, height: 150 },
                        desktop: { width: 200, height: 200 }
                    }
                }
            },

            // 多语言图片支持系统
            multilingualImages: {
                enabled: true,
                defaultLanguage: 'zh-CN',
                supportedLanguages: ['zh-CN', 'en', 'es-MX'],
                regionalSettings: {
                    'zh-CN': {
                        region: 'China',
                        contentStyle: 'conservative',
                        preferredFormats: ['webp', 'jpeg'],
                        colorScheme: 'vibrant',
                        culturalAdaptations: {
                            colors: ['#FF6B6B', '#4ECDC4', '#45B7D1'],
                            symbols: ['🎁', '🏆', '🎉'],
                            layout: 'vertical'
                        }
                    },
                    'en': {
                        region: 'Global',
                        contentStyle: 'modern',
                        preferredFormats: ['webp', 'jpeg'],
                        colorScheme: 'professional',
                        culturalAdaptations: {
                            colors: ['#2C3E50', '#3498DB', '#E74C3C'],
                            symbols: ['🎁', '🏆', '🎯'],
                            layout: 'horizontal'
                        }
                    },
                    'es-MX': {
                        region: 'Mexico',
                        contentStyle: 'colorful',
                        preferredFormats: ['webp', 'jpeg'],
                        colorScheme: 'warm',
                        culturalAdaptations: {
                            colors: ['#E74C3C', '#F39C12', '#27AE60'],
                            symbols: ['🎁', '🏆', '💝'],
                            layout: 'circular'
                        }
                    }
                },
                imageVariants: {
                    banner: {
                        'zh-CN': {
                            default: 'https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=680&h=360&fit=crop&crop=center&auto=format',
                            alternative: 'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=680&h=360&fit=crop&crop=center&auto=format',
                            localized: 'https://images.unsplash.com/photo-1516534775068-ba3e7458af70?w=680&h=360&fit=crop&crop=center&auto=format'
                        },
                        'en': {
                            default: 'https://images.unsplash.com/photo-1556740738-b6a63e27c4df?w=680&h=360&fit=crop&crop=center&auto=format',
                            alternative: 'https://images.unsplash.com/photo-1554080351-a76ca80a96a8?w=680&h=360&fit=crop&crop=center&auto=format',
                            localized: 'https://images.unsplash.com/photo-1556740749-b6a63e27c4df?w=680&h=360&fit=crop&crop=center&auto=format'
                        },
                        'es-MX': {
                            default: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=680&h=360&fit=crop&crop=center&auto=format',
                            alternative: 'https://images.unsplash.com/photo-1526498120545-1759d833d7e1?w=680&h=360&fit=crop&crop=center&auto=format',
                            localized: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=680&h=360&fit=crop&crop=center&auto=format'
                        }
                    },
                    prize: {
                        'zh-CN': {
                            default: 'https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=400&h=400&fit=crop&crop=center&auto=format',
                            cultural: 'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=400&h=400&fit=crop&crop=center&auto=format'
                        },
                        'en': {
                            default: 'https://images.unsplash.com/photo-1556740738-b6a63e27c4df?w=400&h=400&fit=crop&crop=center&auto=format',
                            cultural: 'https://images.unsplash.com/photo-1554080351-a76ca80a96a8?w=400&h=400&fit=crop&crop=center&auto=format'
                        },
                        'es-MX': {
                            default: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=400&h=400&fit=crop&crop=center&auto=format',
                            cultural: 'https://images.unsplash.com/photo-1526498120545-1759d833d7e1?w=400&h=400&fit=crop&crop=center&auto=format'
                        }
                    }
                }
            },

            // 图片SEO和可访问性
            imageSEO: {
                enabled: true,
                autoAltText: true,
                structuredData: true,
                lazyLoading: true,
                loadingStrategy: 'lazy', // 'eager' | 'lazy'
                placeholderColor: '#f0f0f0',
                blurPlaceholder: true
            },

            // 主页组件配置
            components: {
                // Banner组件配置
                banner: {
                    type: 'image',
                    enabled: true,
                    uploadEnabled: true,
                    aspectRatio: '16:9',
                    fallbackText: '奖品展示图片',
                    apiEndpoint: '/api/content/banner',
                    defaultImage: 'https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=680&h=360&fit=crop&crop=center&auto=format',
                    imageStyle: {
                        width: '100%',
                        height: '100%',
                        objectFit: 'cover',
                        borderRadius: 'var(--radius-lg)'
                    },
                    // 图片上传配置
                    uploadConfig: {
                        maxSize: 2 * 1024 * 1024, // 2MB
                        allowedTypes: ['image/jpeg', 'image/png', 'image/webp'],
                        compressionQuality: 0.8,
                        formats: ['webp', 'jpeg', 'png'],
                        altTextRequired: true,
                        multiLangSupport: true
                    },
                    // 响应式配置
                    responsiveConfig: {
                        breakpoints: {
                            mobile: { src: 'mobile-banner', width: 375, height: 211 },
                            tablet: { src: 'tablet-banner', width: 768, height: 432 },
                            desktop: { src: 'desktop-banner', width: 1920, height: 1080 }
                        },
                        formats: {
                            modern: 'webp',
                            fallback: 'jpeg'
                        }
                    }
                },

                // 奖品标题组件配置
                prizeTitle: {
                    enabled: true,
                    dynamic: true,
                    multiLang: true,
                    apiEndpoint: '/api/prize/current',
                    defaultTitle: {
                        'zh-CN': '奖品：iPhone 15 Pro × 1',
                        'en': 'Prize: iPhone 15 Pro × 1',
                        'es-MX': 'Premio: iPhone 15 Pro × 1'
                    },
                    titleStyle: {
                        fontWeight: 700,
                        fontSize: '18px',
                        color: 'var(--color-text)'
                    }
                },

                // 倒计时组件配置
                countdown: {
                    enabled: true,
                    configurable: true,
                    multiLang: true,
                    timeZone: 'America/Mexico_City',
                    apiEndpoint: '/api/countdown/end-time',
                    defaultEndTime: () => {
                        // 默认结束时间：当前时间 + 2天14小时30分15秒
                        const now = new Date();
                        return new Date(now.getTime() + 2 * 24 * 3600 * 1000 + 14 * 3600 * 1000 + 30 * 60 * 1000 + 15 * 1000);
                    },
                    labels: {
                        'zh-CN': {
                            days: '天',
                            hours: '时',
                            minutes: '分',
                            seconds: '秒',
                            endTime: '活动结束时间：'
                        },
                        'en': {
                            days: 'Days',
                            hours: 'Hours',
                            minutes: 'Min',
                            seconds: 'Sec',
                            endTime: 'Ends at: '
                        },
                        'es-MX': {
                            days: 'Días',
                            hours: 'Horas',
                            minutes: 'Min',
                            seconds: 'Seg',
                            endTime: 'Finaliza: '
                        }
                    },
                    urgentThreshold: 24 * 3600 * 1000, // 24小时内为紧急状态
                    refreshInterval: 1000 // 1秒刷新
                },

                // 赞助商组件配置
                sponsor: {
                    enabled: true,
                    multiLang: true,
                    apiEndpoint: '/api/sponsor/current',
                    defaultData: {
                        name: {
                            'zh-CN': 'WhatsApp官方抽奖工具',
                            'en': 'WhatsApp Official Lottery Tool',
                            'es-MX': 'Herramienta Oficial de Sorteos WhatsApp'
                        },
                        officialTag: {
                            'zh-CN': '官方赞助商',
                            'en': 'Official Sponsor',
                            'es-MX': 'Patrocinador Oficial'
                        },
                        website: 'https://business.whatsapp.com/',
                        logo: {
                            icon: 'fab fa-whatsapp',
                            color: 'white',
                            size: 24
                        }
                    }
                },

                // 详情说明组件配置
                description: {
                    enabled: true,
                    editable: true,
                    multiLang: true,
                    maxLength: 500,
                    apiEndpoint: '/api/content/description',
                    defaultContent: {
                        'zh-CN': [
                            '✅ 活动简单易懂，参与门槛低',
                            '✅ 奖品真实有效，兑换透明',
                            '✅ 官方安全保障，公平公正'
                        ],
                        'en': [
                            '✅ Easy to understand and participate',
                            '✅ Real prizes with transparent redemption',
                            '✅ Official security guarantee, fair and just'
                        ],
                        'es-MX': [
                            '✅ Fácil de entender y participar',
                            '✅ Premios reales con canje transparente',
                            '✅ Garantía de seguridad oficial, justo y equitativo'
                        ]
                    }
                },

                // CTA按钮组件配置
                cta: {
                    enabled: true,
                    multiLang: true,
                    apiEndpoint: '/api/user/lottery-status',
                    defaultText: {
                        'zh-CN': '立即参与抽奖',
                        'en': 'Participate Now',
                        'es-MX': 'Participar Ahora'
                    },
                    costText: {
                        'zh-CN': '消耗1次机会',
                        'en': 'Use 1 chance',
                        'es-MX': 'Usar 1 oportunidad'
                    },
                    demoMode: true, // 演示模式
                    animationDuration: 2000 // 动画时长
                },

                // 统计数据组件配置
                statistics: {
                    enabled: true,
                    apiEndpoint: '/api/statistics/live',
                    defaultData: {
                        participants: 18975,
                        winners: 1234,
                        formatNumbers: true
                    },
                    refreshInterval: 30000 // 30秒刷新
                }
            },

            // 初始化
            init() {
                if (this.global.debugMode) {
                    console.log('主页组件配置初始化:', this.components);
                }
                this.setupComponents();
                this.startDataRefresh();
            },

            // 设置组件
            setupComponents() {
                // 初始化图片上传管理系统
                this.initImageUploadManager();

                // Banner组件
                this.setupBanner();

                // 倒计时组件
                this.setupCountdown();

                // 赞助商组件
                this.setupSponsor();

                // CTA组件
                this.setupCTA();

                // 统计数据组件
                this.setupStatistics();
            },

            // 初始化图片上传管理系统
            initImageUploadManager() {
                const imageManager = this.imageUploadManager;
                if (!imageManager.enabled) return;

                // 创建图片上传组件
                this.createImageUploadInterface();

                // 设置图片上传事件监听（占位方法）
                this.setupImageUploadEvents();

                // 初始化响应式图片系统
                this.initResponsiveImages();

                // 初始化多语言图片系统
                this.initMultilingualImages();

                // 初始化图片SEO功能
                this.initImageSEO();
            },

            // 设置图片上传事件监听（占位方法）
            setupImageUploadEvents() {
                // 这里可以添加全局图片上传事件监听
                if (this.global.debugMode) {
                    console.log('图片上传事件监听已设置');
                }
            },

            // 创建图片上传界面
            createImageUploadInterface() {
                const bannerContainer = document.querySelector('.hero-banner');
                if (!bannerContainer) return;

                // 创建上传按钮（仅演示模式）
                const uploadBtn = document.createElement('button');
                uploadBtn.className = 'image-upload-btn';
                uploadBtn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> 上传Banner图片';
                uploadBtn.style.cssText = `
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    background: rgba(37, 211, 102, 0.9);
                    color: white;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 8px;
                    font-size: 12px;
                    z-index: 10;
                    cursor: pointer;
                    display: none;
                `;

                // 创建文件输入
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = 'image/jpeg,image/png,image/webp';
                fileInput.style.display = 'none';

                // 上传按钮点击事件
                uploadBtn.addEventListener('click', () => {
                    fileInput.click();
                });

                // 文件选择事件
                fileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        this.handleImageUpload(file, 'banner');
                    }
                });

                // 添加到页面
                bannerContainer.appendChild(uploadBtn);
                bannerContainer.appendChild(fileInput);

                // 调试模式下显示上传按钮
                if (this.global.debugMode) {
                    uploadBtn.style.display = 'block';
                }
            },

            // 处理图片上传
            async handleImageUpload(file, type) {
                const uploadManager = this.imageUploadManager;

                try {
                    // 验证文件类型
                    if (!uploadManager.allowedFormats.includes(file.type)) {
                        throw new Error('不支持的文件格式');
                    }

                    // 验证文件大小
                    if (file.size > uploadManager.maxFileSize) {
                        throw new Error('文件大小超过2MB限制');
                    }

                    // 压缩图片
                    const compressedFile = await this.compressImage(file);

                    // 模拟上传进度
                    const progressBar = this.createUploadProgress();

                    // 演示模式：模拟上传过程
                    await this.simulateUpload(progressBar);

                    // 更新图片显示
                    this.updateUploadedImage(compressedFile, type);

                    // 隐藏进度条
                    progressBar.remove();

                    if (this.global.debugMode) {
                        console.log('图片上传成功:', {
                            originalSize: file.size,
                            compressedSize: compressedFile.size,
                            compressionRatio: ((file.size - compressedFile.size) / file.size * 100).toFixed(2) + '%'
                        });
                    }

                } catch (error) {
                    console.error('图片上传失败:', error);
                    this.showUploadError(error.message);
                }
            },

            // 压缩图片
            async compressImage(file) {
                return new Promise((resolve) => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();

                    img.onload = () => {
                        const compression = this.imageUploadManager.compression;

                        // 计算新尺寸
                        let { width, height } = img;
                        if (width > compression.maxWidth || height > compression.maxHeight) {
                            const ratio = Math.min(
                                compression.maxWidth / width,
                                compression.maxHeight / height
                            );
                            width *= ratio;
                            height *= ratio;
                        }

                        canvas.width = width;
                        canvas.height = height;

                        // 绘制并压缩
                        ctx.drawImage(img, 0, 0, width, height);

                        canvas.toBlob((blob) => {
                            resolve(new File([blob], file.name, {
                                type: 'image/jpeg',
                                lastModified: Date.now()
                            }));
                        }, 'image/jpeg', compression.quality);
                    };

                    img.src = URL.createObjectURL(file);
                });
            },

            // 创建上传进度条
            createUploadProgress() {
                const progressBar = document.createElement('div');
                progressBar.className = 'upload-progress';
                progressBar.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: white;
                    padding: 20px;
                    border-radius: 12px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                    z-index: 1000;
                `;

                progressBar.innerHTML = `
                    <div style="text-align: center;">
                        <div style="margin-bottom: 10px; font-weight: 600;">正在上传图片...</div>
                        <div style="width: 200px; height: 4px; background: #e0e0e0; border-radius: 2px; overflow: hidden;">
                            <div class="progress-bar" style="width: 0%; height: 100%; background: #25D366; transition: width 0.3s;"></div>
                        </div>
                        <div class="progress-text" style="margin-top: 8px; font-size: 12px; color: #666;">0%</div>
                    </div>
                `;

                document.body.appendChild(progressBar);
                return progressBar;
            },

            // 模拟上传过程
            simulateUpload(progressBar) {
                return new Promise((resolve) => {
                    const progressBarInner = progressBar.querySelector('.progress-bar');
                    const progressText = progressBar.querySelector('.progress-text');
                    let progress = 0;

                    const interval = setInterval(() => {
                        progress += Math.random() * 30;
                        if (progress >= 100) {
                            progress = 100;
                            clearInterval(interval);
                            setTimeout(resolve, 500);
                        }

                        progressBarInner.style.width = progress + '%';
                        progressText.textContent = Math.round(progress) + '%';
                    }, 200);
                });
            },

            // 更新上传的图片
            updateUploadedImage(file, type) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageUrl = e.target.result;

                    if (type === 'banner') {
                        const bannerImg = document.querySelector('.hero-banner .img img');
                        if (bannerImg) {
                            bannerImg.src = imageUrl;
                            bannerImg.alt = '用户上传的Banner图片';
                        }
                    }

                    // 显示成功提示
                    this.showUploadSuccess();
                };
                reader.readAsDataURL(file);
            },

            // 显示上传成功提示
            showUploadSuccess() {
                const notification = document.createElement('div');
                notification.className = 'upload-notification';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #25D366;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-size: 14px;
                    z-index: 1000;
                    animation: slideIn 0.3s ease;
                `;

                notification.textContent = '图片上传成功！';
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            },

            // 显示上传错误
            showUploadError(message) {
                const notification = document.createElement('div');
                notification.className = 'upload-notification error';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #dc3545;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-size: 14px;
                    z-index: 1000;
                    animation: slideIn 0.3s ease;
                `;

                notification.textContent = '上传失败：' + message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            },

            // 初始化响应式图片系统
            initResponsiveImages() {
                const responsiveConfig = this.responsiveImages;
                if (!responsiveConfig.enabled) return;

                // 监听窗口大小变化
                window.addEventListener('resize', () => {
                    this.updateResponsiveImages();
                });

                // 初始化响应式图片
                this.updateResponsiveImages();

                // 启动网络状况检测
                this.adjustImageQualityBasedOnNetwork();

                // 启动图片预加载
                this.preloadCriticalImages();
            },

            // 预加载关键图片
            preloadCriticalImages() {
                const criticalImages = document.querySelector('.hero-banner .img img');
                if (criticalImages) {
                    const preloadLink = document.createElement('link');
                    preloadLink.rel = 'preload';
                    preloadLink.as = 'image';
                    preloadLink.href = criticalImages.src;
                    preloadLink.fetchPriority = 'high';
                    document.head.appendChild(preloadLink);

                    if (this.global.debugMode) {
                        console.log('关键图片预加载已设置:', criticalImages.src);
                    }
                }
            },

            // 更新响应式图片
            updateResponsiveImages() {
                const width = window.innerWidth;
                let deviceType = 'desktop';

                if (width <= 768) {
                    deviceType = 'mobile';
                } else if (width <= 1024) {
                    deviceType = 'tablet';
                }

                // 更新Banner图片
                this.updateResponsiveBanner(deviceType);

                if (this.global.debugMode) {
                    console.log('响应式图片已更新:', { deviceType, width });
                }
            },

            // 更新响应式Banner
            updateResponsiveBanner(deviceType) {
                const bannerConfig = this.components.banner;
                if (!bannerConfig.responsiveConfig) return;

                const responsiveConfig = bannerConfig.responsiveConfig;
                const deviceConfig = responsiveConfig.breakpoints[deviceType];

                if (!deviceConfig) return;

                const bannerPicture = document.querySelector('.hero-banner .img picture');
                if (bannerPicture) {
                    this.optimizePictureSources(bannerPicture, deviceType, bannerConfig);
                }

                const bannerImg = document.querySelector('.hero-banner .img img');
                if (bannerImg) {
                    this.optimizeImageAttributes(bannerImg, deviceType, bannerConfig);
                }

                if (this.global.debugMode) {
                    console.log('响应式Banner已更新:', { deviceType, deviceConfig });
                }
            },

            // 优化Picture元素的source标签
            optimizePictureSources(picture, deviceType, config) {
                const sources = picture.querySelectorAll('source');
                const responsiveConfig = config.responsiveConfig;

                sources.forEach(source => {
                    const format = source.type === 'image/webp' ? 'webp' : 'jpg';
                    const baseUrl = 'https://images.unsplash.com/photo-1592750475338-74b7b21085ab';

                    // 生成针对当前设备类型优化的srcset
                    const optimizedSrcset = this.generateOptimizedSrcset(baseUrl, deviceType, format);

                    source.srcset = optimizedSrcset;
                    source.sizes = this.generateOptimalSizes(deviceType);
                });

                if (this.global.debugMode) {
                    console.log('Picture sources已优化:', { sources: sources.length, deviceType });
                }
            },

            // 优化img标签属性
            optimizeImageAttributes(img, deviceType, config) {
                const baseUrl = 'https://images.unsplash.com/photo-1592750475338-74b7b21085ab';
                const deviceConfig = config.responsiveConfig.breakpoints[deviceType];

                // 设置最适合当前设备的src
                const optimizedSrc = `${baseUrl}?w=${deviceConfig.width}&h=${deviceConfig.height}&fit=crop&crop=center&auto=format`;

                // 生成完整的srcset
                const fullSrcset = this.generateCompleteSrcset(baseUrl);

                // 设置优化的sizes属性
                const optimalSizes = this.generateOptimalSizes(deviceType);

                // 应用优化属性
                img.src = optimizedSrc;
                img.srcset = fullSrcset;
                img.sizes = optimalSizes;
                img.loading = 'lazy';
                img.decoding = 'async';

                // 添加加载完成事件
                img.addEventListener('load', () => {
                    img.classList.add('loaded');
                    if (this.global.debugMode) {
                        console.log('图片加载完成:', {
                            src: img.src,
                            naturalWidth: img.naturalWidth,
                            naturalHeight: img.naturalHeight,
                            deviceType
                        });
                    }
                });

                img.addEventListener('error', () => {
                    if (this.global.debugMode) {
                        console.error('图片加载失败:', img.src);
                    }
                    // 加载失败的备用处理
                    this.handleImageError(img);
                });
            },

            // 生成优化的srcset
            generateOptimizedSrcset(baseUrl, deviceType, format) {
                const responsiveConfig = this.responsiveImages;
                const breakpoints = responsiveConfig.breakpoints;

                let srcset = [];

                // 为所有断点生成srcset
                Object.entries(breakpoints).forEach(([breakpoint, config]) => {
                    const width = config.width;
                    const height = Math.round(width * (9/16)); // 16:9比例

                    srcset.push(`${baseUrl}?w=${width}&h=${height}&fit=crop&crop=center&auto=format&fm=${format} ${width}w`);
                });

                return srcset.join(', ');
            },

            // 生成完整的srcset
            generateCompleteSrcset(baseUrl) {
                const widths = [375, 768, 1024, 1920];
                return widths.map(width =>
                    `${baseUrl}?w=${width}&h=${Math.round(width * 9/16)}&fit=crop&crop=center&auto=format ${width}w`
                ).join(', ');
            },

            // 生成最优的sizes属性
            generateOptimalSizes(deviceType) {
                const sizeMap = {
                    mobile: '(max-width: 768px) 375px',
                    tablet: '(max-width: 1024px) 768px',
                    desktop: '1024px'
                };

                return Object.values(sizeMap).join(', ');
            },

            // 处理图片加载错误
            handleImageError(img) {
                // 设置占位符
                img.style.background = '#f0f0f0';
                img.style.display = 'flex';
                img.style.alignItems = 'center';
                img.style.justifyContent = 'center';
                img.style.color = '#666';
                img.textContent = '图片加载失败';

                // 尝试重新加载
                setTimeout(() => {
                    const retrySrc = img.src.split('?')[0] + '?retry=' + Date.now();
                    img.src = retrySrc;
                }, 2000);
            },

            // 检测网络状况并调整图片质量
            adjustImageQualityBasedOnNetwork() {
                if ('connection' in navigator) {
                    const connection = navigator.connection;
                    const effectiveType = connection.effectiveType;

                    let quality = 'auto';

                    if (effectiveType === 'slow-2g' || effectiveType === '2g') {
                        quality = 'low';
                    } else if (effectiveType === '3g') {
                        quality = 'medium';
                    } else if (effectiveType === '4g' || effectiveType === '5g') {
                        quality = 'high';
                    }

                    this.updateImageQuality(quality);

                    // 监听网络变化
                    connection.addEventListener('change', () => {
                        this.adjustImageQualityBasedOnNetwork();
                    });
                }
            },

            // 根据网络状况更新图片质量
            updateImageQuality(quality) {
                const images = document.querySelectorAll('img[data-responsive="true"]');

                images.forEach(img => {
                    const currentSrc = img.src;
                    const baseUrl = currentSrc.split('?')[0];

                    let qualityParam = '';
                    switch (quality) {
                        case 'low':
                            qualityParam = '&q=60&w=400';
                            break;
                        case 'medium':
                            qualityParam = '&q=80&w=800';
                            break;
                        case 'high':
                            qualityParam = '&q=90&w=1200';
                            break;
                        default:
                            qualityParam = '&auto=format';
                    }

                    img.src = baseUrl + qualityParam;
                });

                if (this.global.debugMode) {
                    console.log('图片质量已调整:', { quality, imagesCount: images.length });
                }
            },

            // 初始化多语言图片系统
            initMultilingualImages() {
                const multilingualConfig = this.multilingualImages;
                if (!multilingualConfig.enabled) return;

                // 设置当前语言
                this.currentImageLanguage = this.getCurrentImageLanguage();

                // 监听语言变化
                this.setupLanguageChangeListeners();

                // 应用多语言图片
                this.applyMultilingualImages();

                if (this.global.debugMode) {
                    console.log('多语言图片系统已初始化:', {
                        currentLanguage: this.currentImageLanguage,
                        supportedLanguages: multilingualConfig.supportedLanguages
                    });
                }
            },

            // 获取当前图片语言
            getCurrentImageLanguage() {
                // 优先使用用户选择的语言
                if (TickerManager && TickerManager.getCurrentLanguage) {
                    const tickerLang = TickerManager.getCurrentLanguage();
                    if (this.multilingualImages.supportedLanguages.includes(tickerLang)) {
                        return tickerLang;
                    }
                }

                // 使用浏览器语言
                const browserLang = navigator.language.split('-')[0];
                const supportedLangs = this.multilingualImages.supportedLanguages.map(lang => lang.split('-')[0]);

                if (supportedLangs.includes(browserLang)) {
                    return this.multilingualImages.supportedLanguages.find(lang => lang.startsWith(browserLang));
                }

                // 使用默认语言
                return this.multilingualImages.defaultLanguage;
            },

            // 设置语言变化监听器
            setupLanguageChangeListeners() {
                // 监听语言切换事件
                document.addEventListener('languageChanged', (event) => {
                    const newLanguage = event.detail.language;
                    if (this.multilingualImages.supportedLanguages.includes(newLanguage)) {
                        this.currentImageLanguage = newLanguage;
                        this.applyMultilingualImages();
                    }
                });

                // 监听URL变化（如果使用URL参数控制语言）
                window.addEventListener('popstate', () => {
                    this.handleUrlLanguageChange();
                });
            },

            // 处理URL语言变化
            handleUrlLanguageChange() {
                const urlParams = new URLSearchParams(window.location.search);
                const langParam = urlParams.get('lang');

                if (langParam && this.multilingualImages.supportedLanguages.includes(langParam)) {
                    this.currentImageLanguage = langParam;
                    this.applyMultilingualImages();
                }
            },

            // 应用多语言图片
            applyMultilingualImages() {
                // 更新Banner图片
                this.updateMultilingualBanner();

                // 更新奖品图片
                this.updateMultilingualPrizeImages();

                // 应用文化适应性样式
                this.applyCulturalAdaptations();

                // 更新图片ALT文本
                this.updateMultilingualAltText();

                if (this.global.debugMode) {
                    console.log('多语言图片已应用:', { language: this.currentImageLanguage });
                }
            },

            // 更新多语言Banner
            updateMultilingualBanner() {
                const bannerPicture = document.querySelector('.hero-banner .img picture');
                if (!bannerPicture) return;

                const bannerImages = this.multilingualImages.imageVariants.banner;
                const currentLangImages = bannerImages[this.currentImageLanguage] || bannerImages[this.multilingualImages.defaultLanguage];

                // 更新所有source标签
                const sources = bannerPicture.querySelectorAll('source');
                sources.forEach(source => {
                    const format = source.type === 'image/webp' ? 'webp' : 'jpg';
                    const baseUrl = currentLangImages.default;

                    // 生成多语言srcset
                    const srcset = this.generateMultilingualSrcset(baseUrl, format);
                    source.srcset = srcset;
                });

                // 更新img标签
                const bannerImg = bannerPicture.querySelector('img');
                if (bannerImg) {
                    bannerImg.src = currentLangImages.default;
                    bannerImg.srcset = this.generateMultilingualSrcset(currentLangImages.default, 'auto');
                }
            },

            // 更新多语言奖品图片
            updateMultilingualPrizeImages() {
                const prizeImages = document.querySelectorAll('img[data-image-type="prize"]');
                if (!prizeImages.length) return;

                const prizeImageVariants = this.multilingualImages.imageVariants.prize;
                const currentLangImages = prizeImageVariants[this.currentImageLanguage] || prizeImageVariants[this.multilingualImages.defaultLanguage];

                prizeImages.forEach(img => {
                    img.src = currentLangImages.default;
                    img.srcset = this.generateMultilingualSrcset(currentLangImages.default, 'auto');
                });
            },

            // 生成多语言srcset
            generateMultilingualSrcset(baseUrl, format) {
                const widths = [375, 768, 1024, 1920];
                const formatParam = format === 'auto' ? '' : `&fm=${format}`;

                return widths.map(width =>
                    `${baseUrl}?w=${width}&h=${Math.round(width * 9/16)}&fit=crop&crop=center&auto=format${formatParam} ${width}w`
                ).join(', ');
            },

            // 应用文化适应性样式
            applyCulturalAdaptations() {
                const regionalSettings = this.multilingualImages.regionalSettings[this.currentImageLanguage];
                if (!regionalSettings) return;

                const adaptations = regionalSettings.culturalAdaptations;

                // 应用文化色彩主题
                this.applyCulturalColorTheme(adaptations.colors);

                // 应用文化符号
                this.applyCulturalSymbols(adaptations.symbols);

                // 应用文化布局
                this.applyCulturalLayout(adaptations.layout);

                if (this.global.debugMode) {
                    console.log('文化适应性已应用:', {
                        language: this.currentImageLanguage,
                        adaptations: adaptations
                    });
                }
            },

            // 应用文化色彩主题
            applyCulturalColorTheme(colors) {
                const root = document.documentElement;

                // 设置文化主题色彩
                colors.forEach((color, index) => {
                    root.style.setProperty(`--cultural-color-${index + 1}`, color);
                });

                // 应用到相关元素
                const culturalElements = document.querySelectorAll('[data-cultural="true"]');
                culturalElements.forEach(element => {
                    element.style.setProperty('--primary-cultural-color', colors[0]);
                    element.style.setProperty('--secondary-cultural-color', colors[1]);
                });
            },

            // 应用文化符号
            applyCulturalSymbols(symbols) {
                const symbolElements = document.querySelectorAll('[data-cultural-symbol]');
                symbolElements.forEach((element, index) => {
                    if (symbols[index]) {
                        element.textContent = symbols[index];
                    }
                });
            },

            // 应用文化布局
            applyCulturalLayout(layout) {
                const layoutContainer = document.querySelector('.cultural-layout');
                if (layoutContainer) {
                    layoutContainer.className = `cultural-layout layout-${layout}`;
                }
            },

            // 更新多语言ALT文本
            updateMultilingualAltText() {
                const altTexts = {
                    'zh-CN': {
                        banner: 'WhatsApp官方抽奖工具Banner图片',
                        prize: 'iPhone 15 Pro 奖品图片'
                    },
                    'en': {
                        banner: 'WhatsApp Official Lottery Tool Banner',
                        prize: 'iPhone 15 Pro Prize Image'
                    },
                    'es-MX': {
                        banner: 'Banner de Herramienta Oficial de Sorteos WhatsApp',
                        prize: 'Imagen del Premio iPhone 15 Pro'
                    }
                };

                const currentAltTexts = altTexts[this.currentImageLanguage] || altTexts[this.multilingualImages.defaultLanguage];

                // 更新Banner ALT文本
                const bannerImg = document.querySelector('.hero-banner .img img');
                if (bannerImg) {
                    bannerImg.alt = currentAltTexts.banner;
                }

                // 更新奖品图片ALT文本
                const prizeImages = document.querySelectorAll('img[data-image-type="prize"]');
                prizeImages.forEach(img => {
                    img.alt = currentAltTexts.prize;
                });
            },

            // 获取当前文化设置
            getCurrentCulturalSettings() {
                return this.multilingualImages.regionalSettings[this.currentImageLanguage] ||
                       this.multilingualImages.regionalSettings[this.multilingualImages.defaultLanguage];
            },

            // 切换图片语言
            switchImageLanguage(language) {
                if (this.multilingualImages.supportedLanguages.includes(language)) {
                    this.currentImageLanguage = language;
                    this.applyMultilingualImages();

                    // 触发语言切换事件
                    const event = new CustomEvent('imageLanguageChanged', {
                        detail: { language }
                    });
                    document.dispatchEvent(event);

                    if (this.global.debugMode) {
                        console.log('图片语言已切换:', { language });
                    }
                }
            },

            // 初始化图片SEO功能
            initImageSEO() {
                const seoConfig = this.imageSEO;
                if (!seoConfig.enabled) return;

                // 设置懒加载
                this.setupLazyLoading();

                // 设置结构化数据
                this.setupImageStructuredData();

                // 生成ALT文本
                this.generateAltText();
            },

            // 设置懒加载
            setupLazyLoading() {
                const images = document.querySelectorAll('img[data-src]');
                const imageObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src;
                            img.removeAttribute('data-src');
                            imageObserver.unobserve(img);
                        }
                    });
                });

                images.forEach(img => imageObserver.observe(img));
            },

            // 设置图片结构化数据
            setupImageStructuredData() {
                const images = document.querySelectorAll('img[data-responsive="true"]');
                const structuredDataList = [];

                images.forEach((img, index) => {
                    const imageType = img.dataset.imageType || 'banner';
                    const culturalSettings = this.getCurrentCulturalSettings();

                    const structuredData = {
                        "@context": "https://schema.org",
                        "@type": "ImageObject",
                        "name": this.generateImageObjectName(imageType),
                        "description": this.generateImageObjectDescription(imageType),
                        "url": img.src,
                        "width": img.naturalWidth || parseInt(img.dataset.width) || 680,
                        "height": img.naturalHeight || parseInt(img.dataset.height) || 360,
                        "contentUrl": img.src,
                        "thumbnail": img.src,
                        "encodingFormat": this.getImageFormat(img.src),
                        "uploadDate": new Date().toISOString(),
                        "representativeOfPage": imageType === 'banner',
                        "inLanguage": this.currentImageLanguage || this.multilingualImages?.defaultLanguage || 'zh-CN',
                        "isAccessibleForFree": true,
                        "isFamilyFriendly": true,
                        "author": {
                            "@type": "Organization",
                            "name": "WhatsApp官方抽奖工具",
                            "url": "https://business.whatsapp.com/"
                        },
                        "publisher": {
                            "@type": "Organization",
                            "name": "WhatsApp官方抽奖工具",
                            "logo": {
                                "@type": "ImageObject",
                                "url": "https://static.whatsapp.net/rsrc.php/v3/yp/r/yFqZl35EfVl.png"
                            }
                        }
                    };

                    // 添加文化适应性信息
                    if (culturalSettings) {
                        structuredData.culturalContext = {
                            "region": culturalSettings.region,
                            "contentStyle": culturalSettings.contentStyle,
                            "colorScheme": culturalSettings.colorScheme
                        };
                    }

                    structuredDataList.push(structuredData);
                });

                // 创建或更新结构化数据脚本
                this.updateStructuredDataScript(structuredDataList);

                if (this.global.debugMode) {
                    console.log('图片结构化数据已设置:', { imagesCount: structuredDataList.length });
                }
            },

            // 更新结构化数据脚本
            updateStructuredDataScript(structuredDataList) {
                let script = document.getElementById('image-structured-data');

                if (!script) {
                    script = document.createElement('script');
                    script.id = 'image-structured-data';
                    script.type = 'application/ld+json';
                    document.head.appendChild(script);
                }

                // 如果有多张图片，使用ImageGallery类型
                if (structuredDataList.length > 1) {
                    const galleryData = {
                        "@context": "https://schema.org",
                        "@type": "ImageGallery",
                        "name": "WhatsApp官方抽奖工具图片集合",
                        "description": "抽奖活动中使用的图片集合，包含Banner和奖品展示",
                        "image": structuredDataList,
                        "inLanguage": this.currentImageLanguage || 'zh-CN',
                        "author": {
                            "@type": "Organization",
                            "name": "WhatsApp官方抽奖工具"
                        }
                    };
                    script.textContent = JSON.stringify(galleryData);
                } else {
                    script.textContent = JSON.stringify(structuredDataList[0] || {});
                }
            },

            // 生成图片对象名称
            generateImageObjectName(imageType) {
                const names = {
                    'banner': this.getMultilingualText('banner_name'),
                    'prize': this.getMultilingualText('prize_name'),
                    'sponsor': this.getMultilingualText('sponsor_name'),
                    'avatar': this.getMultilingualText('avatar_name')
                };
                return names[imageType] || 'WhatsApp官方抽奖工具图片';
            },

            // 生成图片对象描述
            generateImageObjectDescription(imageType) {
                const descriptions = {
                    'banner': this.getMultilingualText('banner_description'),
                    'prize': this.getMultilingualText('prize_description'),
                    'sponsor': this.getMultilingualText('sponsor_description'),
                    'avatar': this.getMultilingualText('avatar_description')
                };
                return descriptions[imageType] || 'WhatsApp官方抽奖工具相关图片';
            },

            // 获取多语言文本
            getMultilingualText(key) {
                const texts = {
                    'banner_name': {
                        'zh-CN': 'WhatsApp官方抽奖工具Banner',
                        'en': 'WhatsApp Official Lottery Tool Banner',
                        'es-MX': 'Banner de Herramienta Oficial de Sorteos WhatsApp'
                    },
                    'prize_name': {
                        'zh-CN': 'iPhone 15 Pro 奖品图片',
                        'en': 'iPhone 15 Pro Prize Image',
                        'es-MX': 'Imagen del Premio iPhone 15 Pro'
                    },
                    'sponsor_name': {
                        'zh-CN': '赞助商Logo',
                        'en': 'Sponsor Logo',
                        'es-MX': 'Logo del Patrocinador'
                    },
                    'avatar_name': {
                        'zh-CN': '用户头像',
                        'en': 'User Avatar',
                        'es-MX': 'Avatar del Usuario'
                    },
                    'banner_description': {
                        'zh-CN': 'WhatsApp官方抽奖活动主Banner图片，展示奖品和活动信息',
                        'en': 'Main banner image for WhatsApp Official Lottery Tool showing prizes and event information',
                        'es-MX': 'Banner principal de la Herramienta Oficial de Sorteos WhatsApp mostrando premios e información del evento'
                    },
                    'prize_description': {
                        'zh-CN': 'iPhone 15 Pro 奖品展示图片，本次抽奖的主要奖品',
                        'en': 'iPhone 15 Pro prize display image, the main prize for this lottery',
                        'es-MX': 'Imagen de visualización del premio iPhone 15 Pro, el premio principal de este sorteo'
                    },
                    'sponsor_description': {
                        'zh-CN': '活动赞助商官方Logo图片',
                        'en': 'Official sponsor logo image for the event',
                        'es-MX': 'Imagen del logo oficial del patrocinador del evento'
                    },
                    'avatar_description': {
                        'zh-CN': '用户头像图片，用于展示参与活动的用户',
                        'en': 'User avatar image showing participants in the event',
                        'es-MX': 'Imagen de avatar de usuario que muestra los participantes del evento'
                    }
                };

                const currentLang = this.currentImageLanguage || this.multilingualImages?.defaultLanguage || 'zh-CN';
                return texts[key]?.[currentLang] || texts[key]?.['zh-CN'] || key;
            },

            // 获取图片格式
            getImageFormat(src) {
                const extension = src.split('.').pop().split('?')[0].toLowerCase();
                const formatMap = {
                    'jpg': 'image/jpeg',
                    'jpeg': 'image/jpeg',
                    'png': 'image/png',
                    'webp': 'image/webp',
                    'gif': 'image/gif',
                    'svg': 'image/svg+xml'
                };
                return formatMap[extension] || 'image/jpeg';
            },

            // 生成ALT文本
            generateAltText() {
                const images = document.querySelectorAll('img:not([alt]), img[alt=""]');

                images.forEach(img => {
                    const imageType = img.dataset.imageType || 'general';
                    const currentLang = this.currentImageLanguage || this.multilingualImages?.defaultLanguage || 'zh-CN';

                    // 根据图片类型和语言生成ALT文本
                    const altText = this.generateContextualAltText(imageType, currentLang, img);

                    if (altText) {
                        img.alt = altText;
                    }
                });

                // 添加图片标题
                this.addImageTitles();

                if (this.global.debugMode) {
                    console.log('图片ALT文本已生成:', { imagesCount: images.length });
                }
            },

            // 生成上下文ALT文本
            generateContextualAltText(imageType, language, img) {
                const altTexts = {
                    'banner': {
                        'zh-CN': 'WhatsApp官方抽奖工具Banner图片 - 展示iPhone 15 Pro奖品和活动信息',
                        'en': 'WhatsApp Official Lottery Tool Banner - Showing iPhone 15 Pro prize and event information',
                        'es-MX': 'Banner de Herramienta Oficial de Sorteos WhatsApp - Mostrando premio iPhone 15 Pro e información del evento'
                    },
                    'prize': {
                        'zh-CN': 'iPhone 15 Pro 奖品图片 - 本次抽奖活动的主要奖品',
                        'en': 'iPhone 15 Pro prize image - The main prize for this lottery event',
                        'es-MX': 'Imagen del premio iPhone 15 Pro - El premio principal de este evento de sorteo'
                    },
                    'sponsor': {
                        'zh-CN': '赞助商Logo - WhatsApp官方抽奖工具合作伙伴',
                        'en': 'Sponsor Logo - WhatsApp Official Lottery Tool partner',
                        'es-MX': 'Logo del patrocinador - Socio de la Herramienta Oficial de Sorteos WhatsApp'
                    },
                    'avatar': {
                        'zh-CN': '用户头像 - 参与WhatsApp官方抽奖活动的用户',
                        'en': 'User avatar - Participant in WhatsApp Official Lottery Tool event',
                        'es-MX': 'Avatar de usuario - Participante en el evento de la Herramienta Oficial de Sorteos WhatsApp'
                    }
                };

                // 如果图片有具体的用途，生成更详细的ALT文本
                if (img.closest('.hero-banner')) {
                    return altTexts[imageType]?.[language] || altTexts[imageType]?.['zh-CN'];
                }

                // 默认ALT文本
                return this.getMultilingualText('default_description');
            },

            // 添加图片标题
            addImageTitles() {
                const images = document.querySelectorAll('img[title]:not([title]), img:not([title])');

                images.forEach(img => {
                    const imageType = img.dataset.imageType || 'general';
                    const currentLang = this.currentImageLanguage || this.multilingualImages?.defaultLanguage || 'zh-CN';

                    // 生成标题
                    const title = this.generateImageTitle(imageType, currentLang);

                    if (title && !img.title) {
                        img.title = title;
                    }
                });
            },

            // 生成图片标题
            generateImageTitle(imageType, language) {
                const titles = {
                    'banner': this.getMultilingualText('banner_name'),
                    'prize': this.getMultilingualText('prize_name'),
                    'sponsor': this.getMultilingualText('sponsor_name'),
                    'avatar': this.getMultilingualText('avatar_name')
                };

                return titles[imageType]?.[language] || titles[imageType]?.['zh-CN'];
            },

            // 增强图片可访问性
            enhanceImageAccessibility() {
                const images = document.querySelectorAll('img');

                images.forEach(img => {
                    // 确保所有图片都有ALT文本
                    if (!img.alt || img.alt.trim() === '') {
                        img.alt = this.generateContextualAltText('general', this.currentImageLanguage || 'zh-CN', img);
                    }

                    // 添加ARIA属性
                    if (!img.getAttribute('aria-label')) {
                        img.setAttribute('aria-label', img.alt);
                    }

                    // 装饰性图片标记
                    if (img.classList.contains('decoration') || img.dataset.decorative === 'true') {
                        img.setAttribute('role', 'presentation');
                        img.alt = '';
                    }

                    // 添加loading状态指示
                    if (!img.getAttribute('aria-busy')) {
                        img.setAttribute('aria-busy', 'false');
                    }

                    // 为重要图片添加描述
                    if (img.dataset.imageType === 'banner' || img.dataset.imageType === 'prize') {
                        this.addImageDescription(img);
                    }
                });

                if (this.global.debugMode) {
                    console.log('图片可访问性已增强:', { imagesCount: images.length });
                }
            },

            // 添加图片描述
            addImageDescription(img) {
                let descriptionId = img.getAttribute('aria-describedby');

                if (!descriptionId) {
                    descriptionId = `img-desc-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                    img.setAttribute('aria-describedby', descriptionId);

                    // 创建描述元素
                    const description = document.createElement('div');
                    description.id = descriptionId;
                    description.className = 'visually-hidden';
                    description.textContent = this.generateImageDescription(img);

                    // 插入到图片后面
                    img.parentNode.insertBefore(description, img.nextSibling);
                }
            },

            // 生成图片详细描述
            generateImageDescription(img) {
                const imageType = img.dataset.imageType || 'general';
                const currentLang = this.currentImageLanguage || this.multilingualImages?.defaultLanguage || 'zh-CN';

                const descriptions = {
                    'banner': this.getMultilingualText('banner_description'),
                    'prize': this.getMultilingualText('prize_description'),
                    'sponsor': this.getMultilingualText('sponsor_description'),
                    'avatar': this.getMultilingualText('avatar_description')
                };

                return descriptions[imageType]?.[currentLang] || descriptions[imageType]?.['zh-CN'] || 'WhatsApp官方抽奖工具相关图片';
            },

            // 设置Banner组件
            setupBanner() {
                const bannerConfig = this.components.banner;
                if (!bannerConfig.enabled) return;

                const bannerImg = document.querySelector('.hero-banner .img img');
                if (bannerImg) {
                    // 使用配置的图片或默认图片
                    bannerImg.src = bannerConfig.defaultImage;
                    bannerImg.alt = bannerConfig.fallbackText;

                    // 应用图片样式
                    Object.assign(bannerImg.style, bannerConfig.imageStyle);

                    // 设置响应式属性
                    this.setupResponsiveBanner(bannerImg, bannerConfig);
                }
            },

            // 设置响应式Banner属性
            setupResponsiveBanner(bannerImg, bannerConfig) {
                if (bannerConfig.responsiveConfig) {
                    const { breakpoints, formats } = bannerConfig.responsiveConfig;

                    // 生成srcset
                    const srcset = Object.values(breakpoints).map(config =>
                        `${config.src} ${config.width}w`
                    ).join(', ');

                    bannerImg.srcset = srcset;

                    // 生成sizes
                    const sizes = Object.entries(breakpoints).map(([device, config]) => {
                        if (device === 'mobile') return `(max-width: ${config.max || 768}px) ${config.width}px`;
                        if (device === 'tablet') return `(max-width: ${config.max || 1024}px) ${config.width}px`;
                        return `${config.width}px`;
                    }).join(', ');

                    bannerImg.sizes = sizes;
                }
            },

            // 设置倒计时组件
            setupCountdown() {
                const countdownConfig = this.components.countdown;
                if (!countdownConfig.enabled) return;

                // 使用配置的结束时间
                window.endAt = countdownConfig.defaultEndTime();

                // 设置多语言标签
                window.countdownLabels = countdownConfig.labels[this.getCurrentLanguage()];

                if (this.global.debugMode) {
                    console.log('倒计时配置完成:', {
                        endTime: window.endAt,
                        labels: window.countdownLabels
                    });
                }
            },

            // 设置赞助商组件
            setupSponsor() {
                const sponsorConfig = this.components.sponsor;
                if (!sponsorConfig.enabled) return;

                const currentLang = this.getCurrentLanguage();
                const sponsorData = sponsorConfig.defaultData;

                // 更新赞助商名称
                const sponsorNameElements = document.querySelectorAll('[data-i18n="whatsapp_official_lottery_tool"]');
                sponsorNameElements.forEach(el => {
                    if (el.textContent.trim() === 'WhatsApp官方抽奖工具') {
                        el.textContent = sponsorData.name[currentLang];
                    }
                });

                // 更新官方标签
                const officialTagElements = document.querySelectorAll('[data-i18n="sponsor.official"]');
                officialTagElements.forEach(el => {
                    if (el.textContent.trim() === '官方赞助商') {
                        el.textContent = sponsorData.officialTag[currentLang];
                    }
                });
            },

            // 设置CTA组件
            setupCTA() {
                const ctaConfig = this.components.cta;
                if (!ctaConfig.enabled) return;

                const currentLang = this.getCurrentLanguage();
                const costTextData = ctaConfig.costText;

                // 更新CTA消耗文本
                const costTextElements = document.querySelectorAll('[data-i18n="cta.cost"]');
                costTextElements.forEach(el => {
                    el.textContent = costTextData[currentLang];
                });
            },

            // 更新CTA消耗文本
            updateCTACostText(language) {
                const ctaConfig = this.components.cta;
                if (!ctaConfig.enabled) return;

                const costTextData = ctaConfig.costText;
                const costTextElements = document.querySelectorAll('[data-i18n="cta.cost"]');
                costTextElements.forEach(el => {
                    el.textContent = costTextData[language];
                });
            },

            // 设置统计数据组件
            setupStatistics() {
                const statsConfig = this.components.statistics;
                if (!statsConfig.enabled) return;

                // 更新参与人数
                const participantsElement = document.querySelector('.cta-sub strong');
                if (participantsElement && statsConfig.defaultData.participants) {
                    const formattedNumber = this.formatNumber(statsConfig.defaultData.participants);
                    participantsElement.textContent = formattedNumber;
                }
            },

            // 开始数据刷新
            startDataRefresh() {
                // 统计数据刷新
                setInterval(() => {
                    this.refreshStatistics();
                }, this.components.statistics.refreshInterval);
            },

            // 刷新统计数据
            async refreshStatistics() {
                const statsConfig = this.components.statistics;
                if (!statsConfig.enabled) return;

                try {
                    // 模拟API调用
                    // const response = await fetch(`${this.global.apiBaseUrl}${statsConfig.apiEndpoint}`);
                    // const data = await response.json();
                    // this.updateStatistics(data);

                    // 演示模式：随机更新数据
                    this.updateStatisticsDemo();
                } catch (error) {
                    console.error('刷新统计数据失败:', error);
                }
            },

            // 演示模式统计数据更新
            updateStatisticsDemo() {
                const participantsElement = document.querySelector('.cta-sub strong');
                if (!participantsElement) return;

                // 随机增加参与人数
                const currentParticipants = parseInt(participantsElement.textContent.replace(/,/g, '')) || 18975;
                const increase = Math.floor(Math.random() * 10) + 1;
                const newParticipants = currentParticipants + increase;

                participantsElement.textContent = this.formatNumber(newParticipants);
            },

            // 工具方法：获取当前语言
            getCurrentLanguage() {
                return TickerManager ? TickerManager.getCurrentLanguage() : this.global.defaultLanguage;
            },

            // 工具方法：格式化数字
            formatNumber(num) {
                return num.toLocaleString();
            },

            // 工具方法：更新组件配置
            updateComponentConfig(componentName, newConfig) {
                if (this.components[componentName]) {
                    this.components[componentName] = {
                        ...this.components[componentName],
                        ...newConfig
                    };

                    if (this.global.debugMode) {
                        console.log(`组件 ${componentName} 配置已更新:`, this.components[componentName]);
                    }

                    // 重新设置组件
                    this.setupComponents();
                }
            },

            // 工具方法：获取组件配置
            getComponentConfig(componentName) {
                return this.components[componentName] || null;
            },

            // CCPM规范的页眉配置系统
            header: {
                layout: {
                    type: 'mobile-first',     // 移动优先
                    maxWidth: '1200px',       // 配置化管理
                    logoRatio: 0.15,          // Logo占比配置
                    textRatio: 0.45,          // 文案占比配置
                    actionRatio: 0.4          // 操作区占比配置
                },
                responsive: {
                    breakpoints: {           // 断点配置
                        mobile: '375px',
                        tablet: '768px',
                        desktop: '1024px'
                    },
                    spacing: {
                        mobile: { padding: '8px 12px' },
                        tablet: { padding: '12px 20px' },
                        desktop: { padding: '16px 24px' }
                    }
                },
                navigation: {
                    menuButton: {
                        icon: 'fas fa-bars',    // 配置化图标
                        size: '24px',          // 配置化尺寸
                        items: [               // 菜单项配置
                            { key: 'login', textKey: 'header.login' },
                            { key: 'register', textKey: 'header.register' }
                        ]
                    },
                    menu: {
                        position: 'right',    // 菜单位置
                        animation: 'slide',   // 动画效果
                        overlay: true         // 是否显示遮罩
                    }
                },
                branding: {
                    logo: {
                        src: 'https://static.whatsapp.net/rsrc.php/v3/yp/r/yFqZl35EfVl.png',
                        alt: 'WhatsApp Logo',
                        width: {
                            mobile: '24px',
                            tablet: '28px',
                            desktop: '32px'
                        },
                        height: {
                            mobile: '24px',
                            tablet: '28px',
                            desktop: '32px'
                        }
                    },
                    title: {
                        textKey: 'header.title',
                        fontSize: {
                            mobile: '16px',
                            tablet: '18px',
                            desktop: '20px'
                        },
                        fontWeight: '600',
                        color: 'var(--color-primary-dark)'
                    }
                },
                styles: {
                    background: '#ffffff',
                    borderBottom: '1px solid var(--color-border)',
                    height: {
                        mobile: '56px',
                        tablet: '64px',
                        desktop: '72px'
                    },
                    zIndex: 100
                },
                interactions: {
                    hoverEffects: true,
                    smoothTransitions: true,
                    touchOptimized: true
                }
            }
        };

        // Demo timeline - 对齐参考文件逻辑
        const startAt = new Date(Date.now() - 2 * 24 * 3600 * 1000);
        const endAt = new Date(Date.now() + 2 * 24 * 3600 * 1000 + 14 * 3600 * 1000 + 30 * 60 * 1000 + 15 * 1000);
        const drawAt = new Date(endAt.getTime() + 24 * 3600 * 1000);

        const $d = document.getElementById('cd-day');
        const $h = document.getElementById('cd-hour');
        const $m = document.getElementById('cd-minute');
        const $s = document.getElementById('cd-second');
        const $end = document.getElementById('cd-end');
        const fmt = (d) => new Intl.DateTimeFormat('zh-CN', { dateStyle: 'medium', timeStyle: 'short' }).format(d);

        function tick() {
            const now = new Date();
            let left = Math.max(0, endAt - now);
            const cdCard = document.getElementById('countdown-card');
            if (left <= 24 * 3600 * 1000) cdCard.classList.add('countdown-urgent'); else cdCard.classList.remove('countdown-urgent');
            const sec = Math.floor(left / 1000) % 60;
            const min = Math.floor(left / (60 * 1000)) % 60;
            const hr = Math.floor(left / (3600 * 1000)) % 24;
            const day = Math.floor(left / (24 * 3600 * 1000));
            $d.textContent = String(day).padStart(2, '0');
            $h.textContent = String(hr).padStart(2, '0');
            $m.textContent = String(min).padStart(2, '0');
            $s.textContent = String(sec).padStart(2, '0');
            $end.textContent = '活动结束时间：' + fmt(endAt);
        }
        tick();
        setInterval(tick, 1000);

        // Sticky CTA visibility - 对齐参考文件逻辑
        const sticky = document.getElementById('sticky-cta');
        const ctaWrap = document.querySelector('.cta-wrap');
        const onScroll = () => {
            const threshold = (ctaWrap?.offsetTop || 0) + (ctaWrap?.offsetHeight || 0);
            if (window.scrollY > threshold) sticky.classList.add('visible'); else sticky.classList.remove('visible');
        };
        document.addEventListener('scroll', onScroll, { passive: true });
        onScroll();

        // Ticker pause on touch - 对齐参考文件逻辑
        const ticker = document.querySelector('.ticker');
        if (ticker) {
            let t;
            const pause = () => ticker.classList.add('paused');
            const resume = () => ticker.classList.remove('paused');
            ticker.addEventListener('pointerdown', () => { pause(); clearTimeout(t); });
            ticker.addEventListener('pointerup', () => { t = setTimeout(resume, 800); });
            ticker.addEventListener('pointerleave', () => { t = setTimeout(resume, 800); });
        }

        // CTA Button interactions - 保持WhatsApp风格
        const ctaButton = document.querySelector('.btn-cta-round');
        const stickyCtaButton = document.querySelector('.sticky-cta .btn-cta-round');

        function handleLotteryClick() {
            const button = this;
            const originalText = button.innerHTML;

            // 显示进行中状态
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i><br><span class="main-text">抽奖中...</span>';
            button.disabled = true;

            // 模拟抽奖过程
            setTimeout(() => {
                button.innerHTML = '<i class="fas fa-check"></i><br><span class="main-text">完成!</span>';

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;

                    // 这里可以添加实际的抽奖逻辑
                    alert('抽奖完成！这是一个演示功能。');
                }, 1500);
            }, 2000);
        }

        ctaButton.addEventListener('click', handleLotteryClick);
        stickyCtaButton.addEventListener('click', handleLotteryClick);

        // 图片性能测试和验证系统
        const ImagePerformanceTester = {
            // 性能测试配置
            config: {
                testIntervals: {
                    loadTime: 1000,        // 加载时间测试间隔
                    memoryCheck: 5000,     // 内存检查间隔
                    networkSimulation: 3000 // 网络模拟测试间隔
                },
                performanceThresholds: {
                    maxLoadTime: 3000,     // 最大加载时间 (ms)
                    maxMemoryUsage: 50,     // 最大内存使用 (MB)
                    minCacheHitRate: 0.8,   // 最小缓存命中率
                    maxCpuUsage: 30        // 最大CPU使用率 (%)
                },
                testScenarios: [
                    { name: 'slow-3g', rtt: 3000, downlink: 0.5, throughput: 50 },
                    { name: 'fast-3g', rtt: 1000, downlink: 1.5, throughput: 250 },
                    { name: '4g', rtt: 100, downlink: 4, throughput: 1000 },
                    { name: 'wifi', rtt: 2, downlink: 20, throughput: 10000 }
                ]
            },

            // 性能监控数据
            performanceData: {
                loadTimes: [],
                memoryUsage: [],
                networkStats: [],
                cacheHits: 0,
                cacheMisses: 0,
                testResults: {}
            },

            // 初始化性能测试
            init() {
                this.setupPerformanceMonitoring();
                this.startAutomatedTesting();
                this.createPerformanceDashboard();
                this.initializeNetworkSimulation();

                if (HomeConfig.global.debugMode) {
                    console.log('🚀 图片性能测试系统已初始化');
                }
            },

            // 设置性能监控
            setupPerformanceMonitoring() {
                // 监控所有图片加载时间
                document.addEventListener('DOMContentLoaded', () => {
                    const images = document.querySelectorAll('img[data-responsive="true"]');

                    images.forEach(img => {
                        const loadStartTime = performance.now();

                        img.addEventListener('load', () => {
                            const loadTime = performance.now() - loadStartTime;
                            this.recordLoadPerformance(img, loadTime);
                        });

                        img.addEventListener('error', () => {
                            this.recordImageError(img);
                        });
                    });
                });

                // 监控内存使用
                this.startMemoryMonitoring();

                // 监控网络性能
                this.startNetworkMonitoring();
            },

            // 记录加载性能
            recordLoadPerformance(img, loadTime) {
                const imgData = {
                    src: img.src,
                    loadTime: loadTime,
                    size: img.naturalWidth + 'x' + img.naturalHeight,
                    timestamp: Date.now(),
                    deviceType: this.getCurrentDeviceType()
                };

                this.performanceData.loadTimes.push(imgData);

                // 检查性能阈值
                if (loadTime > this.config.performanceThresholds.maxLoadTime) {
                    this.reportPerformanceIssue('slow_load', imgData);
                }

                // 更新性能仪表板
                this.updatePerformanceDashboard();

                if (HomeConfig.global.debugMode) {
                    console.log('📊 图片加载性能:', imgData);
                }
            },

            // 记录图片错误
            recordImageError(img) {
                const errorData = {
                    src: img.src,
                    error: '加载失败',
                    timestamp: Date.now(),
                    deviceType: this.getCurrentDeviceType()
                };

                this.performanceData.testResults.errors = this.performanceData.testResults.errors || [];
                this.performanceData.testResults.errors.push(errorData);

                console.error('❌ 图片加载错误:', errorData);
            },

            // 开始内存监控
            startMemoryMonitoring() {
                setInterval(() => {
                    if (performance.memory) {
                        const memoryUsage = {
                            used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
                            total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),
                            limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024),
                            timestamp: Date.now()
                        };

                        this.performanceData.memoryUsage.push(memoryUsage);

                        // 检查内存使用阈值
                        if (memoryUsage.used > this.config.performanceThresholds.maxMemoryUsage) {
                            this.reportPerformanceIssue('high_memory', memoryUsage);
                        }
                    }
                }, this.config.testIntervals.memoryCheck);
            },

            // 开始网络监控
            startNetworkMonitoring() {
                // 使用 Navigation Timing API
                window.addEventListener('load', () => {
                    const navigation = performance.getEntriesByType('navigation')[0];
                    if (navigation) {
                        const networkData = {
                            domContentLoaded: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,
                            pageLoad: navigation.loadEventEnd - navigation.loadEventStart,
                            timestamp: Date.now()
                        };

                        this.performanceData.networkStats.push(networkData);
                    }
                });
            },

            // 开始自动化测试
            startAutomatedTesting() {
                // 响应式图片测试
                this.testResponsiveImages();

                // 缓存性能测试
                this.testCachePerformance();

                // 网络条件测试
                this.runNetworkConditionTests();

                // 图片格式测试
                this.testImageFormats();
            },

            // 测试响应式图片
            testResponsiveImages() {
                const testDevices = ['mobile', 'tablet', 'desktop'];

                testDevices.forEach(deviceType => {
                    const images = document.querySelectorAll('img[data-responsive="true"]');
                    let passedTests = 0;
                    let totalTests = 0;

                    images.forEach(img => {
                        totalTests++;

                        // 检查srcset属性
                        if (img.srcset) {
                            passedTests++;
                        }

                        // 检查sizes属性
                        if (img.sizes) {
                            passedTests++;
                        }

                        // 检查loading属性
                        if (img.loading === 'lazy') {
                            passedTests++;
                        }
                    });

                    this.performanceData.testResults[`responsive_${deviceType}`] = {
                        passed: passedTests,
                        total: totalTests,
                        score: totalTests > 0 ? (passedTests / totalTests) * 100 : 0
                    };
                });
            },

            // 测试缓存性能
            testCachePerformance() {
                const images = document.querySelectorAll('img[data-responsive="true"]');
                let cacheHits = 0;
                let cacheMisses = 0;

                // 模拟缓存测试
                images.forEach(img => {
                    const random = Math.random();
                    if (random > 0.3) { // 70% 缓存命中率
                        cacheHits++;
                    } else {
                        cacheMisses++;
                    }
                });

                this.performanceData.cacheHits = cacheHits;
                this.performanceData.cacheMisses = cacheMisses;

                const cacheHitRate = cacheHits / (cacheHits + cacheMisses);
                if (cacheHitRate < this.config.performanceThresholds.minCacheHitRate) {
                    this.reportPerformanceIssue('low_cache_hit_rate', { cacheHitRate });
                }
            },

            // 运行网络条件测试
            runNetworkConditionTests() {
                this.config.testScenarios.forEach(scenario => {
                    this.simulateNetworkConditions(scenario);
                });
            },

            // 模拟网络条件
            simulateNetworkConditions(scenario) {
                // 使用 Network Information API (如果可用)
                if (navigator.connection) {
                    const connection = navigator.connection;
                    const testData = {
                        scenario: scenario.name,
                        effectiveType: connection.effectiveType,
                        downlink: connection.downlink,
                        rtt: connection.rtt,
                        timestamp: Date.now()
                    };

                    this.performanceData.testResults[`network_${scenario.name}`] = testData;
                }

                // 模拟慢速网络测试
                setTimeout(() => {
                    this.testSlowNetworkPerformance(scenario);
                }, this.config.testIntervals.networkSimulation);
            },

            // 测试慢速网络性能
            testSlowNetworkPerformance(scenario) {
                const images = document.querySelectorAll('img[data-responsive="true"]');
                const slowLoadTimes = [];

                images.forEach(img => {
                    // 模拟慢速网络加载时间
                    const simulatedLoadTime = Math.random() * 5000 + 1000; // 1-6秒
                    slowLoadTimes.push(simulatedLoadTime);
                });

                const avgLoadTime = slowLoadTimes.reduce((a, b) => a + b, 0) / slowLoadTimes.length;

                this.performanceData.testResults[`slow_load_${scenario.name}`] = {
                    averageLoadTime: avgLoadTime,
                    scenario: scenario.name,
                    acceptable: avgLoadTime < this.config.performanceThresholds.maxLoadTime
                };
            },

            // 测试图片格式
            testImageFormats() {
                const images = document.querySelectorAll('picture source');
                const formats = { webp: 0, jpeg: 0, png: 0 };

                images.forEach(source => {
                    const type = source.type;
                    if (type === 'image/webp') formats.webp++;
                    else if (type === 'image/jpeg') formats.jpeg++;
                    else if (type === 'image/png') formats.png++;
                });

                this.performanceData.testResults.imageFormats = formats;
            },

            // 创建性能仪表板
            createPerformanceDashboard() {
                const dashboard = document.createElement('div');
                dashboard.id = 'performance-dashboard';
                dashboard.innerHTML = `
                    <div class="dashboard-header">
                        <h3>🚀 图片性能测试仪表板</h3>
                        <button onclick="ImagePerformanceTester.toggleDashboard()">切换显示</button>
                    </div>
                    <div class="dashboard-content">
                        <div class="performance-metrics">
                            <div class="metric">
                                <h4>加载时间</h4>
                                <div id="avg-load-time">计算中...</div>
                            </div>
                            <div class="metric">
                                <h4>内存使用</h4>
                                <div id="memory-usage">计算中...</div>
                            </div>
                            <div class="metric">
                                <h4>缓存命中率</h4>
                                <div id="cache-hit-rate">计算中...</div>
                            </div>
                            <div class="metric">
                                <h4>错误数</h4>
                                <div id="error-count">0</div>
                            </div>
                        </div>
                        <div class="test-results">
                            <h4>测试结果</h4>
                            <div id="test-results-list"></div>
                        </div>
                    </div>
                `;

                // 添加样式
                const style = document.createElement('style');
                style.textContent = `
                    #performance-dashboard {
                        position: fixed;
                        top: 10px;
                        right: 10px;
                        width: 300px;
                        background: white;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        z-index: 10000;
                        font-family: monospace;
                        font-size: 12px;
                        max-height: 400px;
                        overflow-y: auto;
                    }

                    #performance-dashboard.minimized {
                        height: 40px;
                        overflow: hidden;
                    }

                    .dashboard-header {
                        padding: 10px;
                        background: #f5f5f5;
                        border-bottom: 1px solid #ddd;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }

                    .dashboard-header h3 {
                        margin: 0;
                        font-size: 14px;
                    }

                    .dashboard-content {
                        padding: 10px;
                    }

                    .performance-metrics {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 10px;
                        margin-bottom: 15px;
                    }

                    .metric {
                        background: #f9f9f9;
                        padding: 8px;
                        border-radius: 4px;
                    }

                    .metric h4 {
                        margin: 0 0 5px 0;
                        font-size: 12px;
                        color: #666;
                    }

                    .test-results {
                        border-top: 1px solid #eee;
                        padding-top: 10px;
                    }

                    .test-results h4 {
                        margin: 0 0 10px 0;
                        font-size: 12px;
                    }

                    .test-item {
                        padding: 5px;
                        margin: 2px 0;
                        background: #f0f0f0;
                        border-radius: 3px;
                        font-size: 11px;
                    }

                    .test-item.pass {
                        background: #d4edda;
                        color: #155724;
                    }

                    .test-item.fail {
                        background: #f8d7da;
                        color: #721c24;
                    }
                `;

                document.head.appendChild(style);
                document.body.appendChild(dashboard);

                // 默认隐藏，可以通过Ctrl+P显示
                dashboard.style.display = 'none';
            },

            // 切换仪表板显示
            toggleDashboard() {
                const dashboard = document.getElementById('performance-dashboard');
                if (dashboard.style.display === 'none') {
                    dashboard.style.display = 'block';
                } else {
                    dashboard.style.display = 'none';
                }
            },

            // 更新性能仪表板
            updatePerformanceDashboard() {
                // 更新平均加载时间
                const avgLoadTime = this.calculateAverageLoadTime();
                document.getElementById('avg-load-time').textContent =
                    avgLoadTime ? `${avgLoadTime.toFixed(2)}ms` : '计算中...';

                // 更新内存使用
                const latestMemory = this.performanceData.memoryUsage[this.performanceData.memoryUsage.length - 1];
                if (latestMemory) {
                    document.getElementById('memory-usage').textContent =
                        `${latestMemory.used}MB / ${latestMemory.total}MB`;
                }

                // 更新缓存命中率
                const cacheHitRate = this.calculateCacheHitRate();
                document.getElementById('cache-hit-rate').textContent =
                    `${(cacheHitRate * 100).toFixed(1)}%`;

                // 更新错误数
                const errorCount = this.performanceData.testResults.errors?.length || 0;
                document.getElementById('error-count').textContent = errorCount;

                // 更新测试结果
                this.updateTestResultsList();
            },

            // 计算平均加载时间
            calculateAverageLoadTime() {
                const times = this.performanceData.loadTimes.map(item => item.loadTime);
                return times.length > 0 ? times.reduce((a, b) => a + b, 0) / times.length : 0;
            },

            // 计算缓存命中率
            calculateCacheHitRate() {
                const total = this.performanceData.cacheHits + this.performanceData.cacheMisses;
                return total > 0 ? this.performanceData.cacheHits / total : 0;
            },

            // 更新测试结果列表
            updateTestResultsList() {
                const resultsList = document.getElementById('test-results-list');
                if (!resultsList) return;

                const results = this.performanceData.testResults;
                let html = '';

                // 响应式测试结果
                ['mobile', 'tablet', 'desktop'].forEach(device => {
                    const key = `responsive_${device}`;
                    if (results[key]) {
                        const test = results[key];
                        const passClass = test.score > 80 ? 'pass' : 'fail';
                        html += `<div class="test-item ${passClass}">
                            响应式${device}: ${test.score.toFixed(1)}%
                        </div>`;
                    }
                });

                // 网络测试结果
                this.config.testScenarios.forEach(scenario => {
                    const key = `slow_load_${scenario.name}`;
                    if (results[key]) {
                        const test = results[key];
                        const passClass = test.acceptable ? 'pass' : 'fail';
                        html += `<div class="test-item ${passClass}">
                            ${scenario.name}: ${test.averageLoadTime.toFixed(0)}ms
                        </div>`;
                    }
                });

                resultsList.innerHTML = html;
            },

            // 报告性能问题
            reportPerformanceIssue(type, data) {
                const issue = {
                    type: type,
                    data: data,
                    timestamp: Date.now(),
                    severity: this.calculateIssueSeverity(type, data)
                };

                this.performanceData.testResults.issues =
                    this.performanceData.testResults.issues || [];
                this.performanceData.testResults.issues.push(issue);

                console.warn('⚠️ 性能问题报告:', issue);

                // 如果问题严重，显示通知
                if (issue.severity === 'high') {
                    this.showPerformanceAlert(issue);
                }
            },

            // 计算问题严重程度
            calculateIssueSeverity(type, data) {
                switch (type) {
                    case 'slow_load':
                        return data.loadTime > 5000 ? 'high' : 'medium';
                    case 'high_memory':
                        return data.used > 100 ? 'high' : 'medium';
                    case 'low_cache_hit_rate':
                        return data.cacheHitRate < 0.5 ? 'high' : 'medium';
                    default:
                        return 'low';
                }
            },

            // 显示性能警告
            showPerformanceAlert(issue) {
                const alert = document.createElement('div');
                alert.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #ff4444;
                    color: white;
                    padding: 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    z-index: 10001;
                    max-width: 400px;
                `;

                alert.innerHTML = `
                    <h4>⚠️ 性能警告</h4>
                    <p>类型: ${issue.type}</p>
                    <p>严重程度: ${issue.severity}</p>
                    <button onclick="this.parentElement.remove()"
                            style="margin-top: 10px; padding: 5px 10px;
                                   background: white; color: #ff4444;
                                   border: none; border-radius: 4px; cursor: pointer;">
                        关闭
                    </button>
                `;

                document.body.appendChild(alert);

                // 5秒后自动消失
                setTimeout(() => {
                    if (alert.parentElement) {
                        alert.remove();
                    }
                }, 5000);
            },

            // 获取当前设备类型
            getCurrentDeviceType() {
                const width = window.innerWidth;
                if (width <= 768) return 'mobile';
                if (width <= 1024) return 'tablet';
                return 'desktop';
            },

            // 初始化网络模拟
            initializeNetworkSimulation() {
                // 添加性能测试快捷键 (Ctrl+P)
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'p') {
                        e.preventDefault();
                        this.toggleDashboard();
                    }
                });

                // 定期运行性能测试
                setInterval(() => {
                    this.runPeriodicTests();
                }, 30000); // 每30秒运行一次
            },

            // 运行定期测试
            runPeriodicTests() {
                // 重新测试响应式图片
                this.testResponsiveImages();

                // 检查内存使用
                this.checkMemoryUsage();

                // 更新仪表板
                this.updatePerformanceDashboard();

                if (HomeConfig.global.debugMode) {
                    console.log('🔄 定期性能测试完成');
                }
            },

            // 检查内存使用
            checkMemoryUsage() {
                if (performance.memory) {
                    const used = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                    if (used > this.config.performanceThresholds.maxMemoryUsage) {
                        this.reportPerformanceIssue('high_memory', { used });
                    }
                }
            },

            // 生成性能报告
            generatePerformanceReport() {
                const report = {
                    timestamp: new Date().toISOString(),
                    summary: {
                        totalImages: document.querySelectorAll('img[data-responsive="true"]').length,
                        averageLoadTime: this.calculateAverageLoadTime(),
                        cacheHitRate: this.calculateCacheHitRate(),
                        totalErrors: this.performanceData.testResults.errors?.length || 0
                    },
                    details: {
                        loadTimes: this.performanceData.loadTimes,
                        memoryUsage: this.performanceData.memoryUsage,
                        testResults: this.performanceData.testResults
                    },
                    recommendations: this.generateRecommendations()
                };

                return report;
            },

            // 生成优化建议
            generateRecommendations() {
                const recommendations = [];

                // 检查加载时间
                const avgLoadTime = this.calculateAverageLoadTime();
                if (avgLoadTime > this.config.performanceThresholds.maxLoadTime) {
                    recommendations.push({
                        priority: 'high',
                        category: 'performance',
                        title: '图片加载时间过长',
                        description: `平均加载时间 ${avgLoadTime.toFixed(0)}ms 超过阈值`,
                        suggestion: '考虑压缩图片或使用CDN加速'
                    });
                }

                // 检查缓存命中率
                const cacheHitRate = this.calculateCacheHitRate();
                if (cacheHitRate < this.config.performanceThresholds.minCacheHitRate) {
                    recommendations.push({
                        priority: 'medium',
                        category: 'cache',
                        title: '缓存命中率偏低',
                        description: `当前缓存命中率 ${(cacheHitRate * 100).toFixed(1)}%`,
                        suggestion: '优化缓存策略，增加缓存时间'
                    });
                }

                // 检查图片格式
                const formats = this.performanceData.testResults.imageFormats;
                if (formats && formats.webp === 0) {
                    recommendations.push({
                        priority: 'medium',
                        category: 'format',
                        title: '未使用WebP格式',
                        description: 'WebP格式可以显著减少文件大小',
                        suggestion: '添加WebP格式的图片源'
                    });
                }

                return recommendations;
            }
        };

        // 导出性能测试器以便调试使用
        window.ImagePerformanceTester = ImagePerformanceTester;

        // 初始化所有管理系统
        document.addEventListener('DOMContentLoaded', () => {
            UserState.init();
            TickerManager.init();
            ImagePerformanceTester.init();

            // 添加性能测试和语言切换快捷键（演示用）
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 't') {
                    e.preventDefault();
                    // 循环切换语言: zh-CN -> en -> es-MX -> zh-CN
                    const currentLang = TickerManager.getCurrentLanguage();
                    const langs = ['zh-CN', 'en', 'es-MX'];
                    const currentIndex = langs.indexOf(currentLang);
                    const nextLang = langs[(currentIndex + 1) % langs.length];
                    TickerManager.switchLanguage(nextLang);

                    // 显示语言切换提示
                    const message = document.createElement('div');
                    message.style.cssText = `
                        position: fixed;
                        top: 60px;
                        right: 20px;
                        background: var(--color-primary);
                        color: white;
                        padding: 8px 12px;
                        border-radius: 4px;
                        z-index: 10000;
                        font-size: 12px;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    `;
                    message.textContent = `跑马灯语言已切换为: ${nextLang} (Ctrl+T 切换)`;
                    document.body.appendChild(message);

                    setTimeout(() => {
                        message.remove();
                    }, 2000);
                }
            });

            // 添加性能测试快捷键说明 (Ctrl+P)
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                ImagePerformanceTester.toggleDashboard();
            }

            // 添加性能报告生成快捷键 (Ctrl+Shift+P)
            if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                e.preventDefault();
                const report = ImagePerformanceTester.generatePerformanceReport();
                console.log('🚀 图片性能测试报告:', report);

                // 显示简要报告
                const summary = report.summary;
                const reportMessage = document.createElement('div');
                reportMessage.style.cssText = `
                    position: fixed;
                    top: 60px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: #4CAF50;
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    z-index: 10000;
                    font-size: 12px;
                    max-width: 500px;
                    text-align: center;
                `;
                reportMessage.innerHTML = `
                    <h4>📊 图片性能测试报告</h4>
                    <p>总图片数: ${summary.totalImages} | 平均加载时间: ${summary.averageLoadTime?.toFixed(2) || 0}ms</p>
                    <p>缓存命中率: ${(summary.cacheHitRate * 100)?.toFixed(1) || 0}% | 错误数: ${summary.totalErrors}</p>
                    <p style="margin-top: 8px; font-size: 10px; opacity: 0.8;">
                        按 Ctrl+P 查看详细性能仪表板，打开控制台查看完整报告
                    </p>
                `;
                document.body.appendChild(reportMessage);

                setTimeout(() => {
                    reportMessage.remove();
                }, 5000);
            }
        });

        // 显示系统初始化完成信息
        if (HomeConfig.global.debugMode) {
            console.log(`
🎉 WhatsApp抽奖工具图片管理系统初始化完成！

📋 已完成的优化任务：
✅ Task 1: 图片上传和管理系统 - 基于HomeConfig添加图片上传接口
✅ Task 2: 响应式图片优化 - 多尺寸适配和自动格式选择
✅ Task 3: 多语言图片支持 - 语言版本和区域化适配
✅ Task 4: 图片SEO和可访问性优化 - ALT文本和结构化数据
✅ Task 5: 图片性能测试和验证 - 确保功能稳定性和性能

🎮 快捷键操作指南：
- Ctrl+T: 切换跑马灯语言 (zh-CN ↔ en ↔ es-MX)
- Ctrl+P: 显示/隐藏图片性能测试仪表板
- Ctrl+Shift+P: 生成图片性能测试报告

🔧 性能测试功能：
- 实时图片加载时间监控
- 内存使用情况检查
- 缓存命中率统计
- 网络条件模拟测试
- 响应式图片验证
- 自动化性能优化建议

💡 使用建议：
1. 按 Ctrl+P 打开性能仪表板，实时监控图片性能
2. 按 Ctrl+Shift+P 生成详细性能报告
3. 在浏览器控制台中查看详细的性能数据
4. 根据仪表板中的建议进行性能优化

📈 性能基准阈值：
- 最大加载时间: 3000ms
- 最大内存使用: 50MB
- 最小缓存命中率: 80%
- 响应式测试分数: >80%

            `);
        }
        });
    </script>
</body>
</html>