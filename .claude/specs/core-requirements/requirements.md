# 核心需求规格 (Core Requirements Specification)

## 📋 **文档信息**
**Spec名称**: core-requirements  
**创建日期**: 2024年9月29日  
**版本**: v1.0  
**状态**: 进行中  

## 🎯 **产品概览**

### **产品定位**
WhatsApp抽奖活动系统是一款基于H5的病毒式传播营销活动工具，专门为希望通过低成本社交裂变获取新用户的商家和品牌设计。

### **核心价值主张**
- **用户增长**: 实现病毒式传播，最大化活动参与人数
- **粉丝沉淀**: 将所有参与者转化为WhatsApp商业号的可触达粉丝
- **私域构建**: 帮助商家构建强大的私域流量池

### **品牌关键词对齐**
基于已确认的品牌关键词，产品需求必须体现：
- **专业**: 企业级工具品质，数据展示清晰准确
- **信赖**: 透明信息展示，安全认证，规则公开
- **高效**: 简洁操作流程，一键参与，自动化处理
- **社交**: 人性化交互，分享乐趣，群体参与感
- **增长**: 上升趋势元素，激励性设计，成就反馈

---

## 👥 **用户角色定义**

### **主要用户角色**

#### **1. 终端用户 (End Users)**
**角色描述**: 通过邀请链接或自然流量访问活动的普通用户  
**用户特征**:
- 年龄: 18-45岁，移动端使用习惯良好
- 动机: 希望获得奖品，愿意参与简单的社交分享
- 技能水平: 基础移动设备操作能力

**子角色**:
- **新用户**: 首次访问活动的用户
- **被邀请用户**: 通过邀请链接访问的用户  
- **老用户**: 曾经参与过活动的返回用户
- **中奖用户**: 在抽奖中获得奖品的用户

#### **2. 商家运营者 (Business Operators)**
**角色描述**: 使用系统创建和管理抽奖活动的商家或品牌方  
**用户特征**:
- 角色: 市场营销人员、运营专员、小企业主
- 目标: 低成本获客，提升品牌知名度，建立私域流量
- 技能水平: 基础营销工具使用经验，非技术背景

#### **3. 系统管理员 (System Administrators)**
**角色描述**: 负责系统维护和高级配置的技术人员  
**用户特征**:
- 角色: 技术支持、系统维护人员
- 目标: 系统稳定运行，数据安全，性能优化
- 技能水平: 技术专业人员

---

## 📱 **用户故事 (User Stories)**

### **Epic 1: 用户激活与参与**

#### **Story 1.1: 新用户发现活动**
**作为** 一个潜在用户  
**我希望** 能够通过清晰吸引的落地页了解活动详情  
**以便** 我能决定是否参与这个抽奖活动  

**验收标准**:
- [ ] 落地页清晰展示所有奖品等级和数量
- [ ] **Banner图支持后台上传配置**
- [ ] **Banner左上角显示跑马灯元素**（"xxx参与了抽奖"，"xx邀请了x个人"）
- [ ] **奖品详情页图片支持后台上传**
- [ ] **CTA区域显示已参与抽奖人数**（支持假数据配置）
- [ ] 显示活动倒计时和参与人数
- [ ] 提供唯一明确的参与按钮
- [ ] 展示活动规则和赞助商信息
- [ ] 支持移动端响应式显示

#### **Story 1.2: 被邀请用户获得个性化体验**
**作为** 一个被朋友邀请的用户  
**我希望** 看到个性化的邀请信息和专属奖励  
**以便** 我感受到朋友的关心并更愿意参与活动  

**验收标准**:
- [ ] 页面显示"[朋友名]送你一个抽奖码"的个性化Toast
- [ ] CTA按钮文案优化为"领取并参与"
- [ ] 邀请者信息存储在localStorage中
- [ ] 被邀请者激活成功后邀请者立即获得奖励

#### **Story 1.3: 用户一键参与激活**
**作为** 一个想要参与活动的用户  
**我希望** 通过简单的WhatsApp消息发送完成参与  
**以便** 我不需要复杂的注册流程就能快速加入活动  

**验收标准**:
- [ ] 点击参与按钮生成唯一SESSION_ID
- [ ] 自动跳转到WhatsApp并预填消息"我要参与-[SESSION_ID]"
- [ ] 用户发送消息后后台获取手机号并完成身份绑定
- [ ] WhatsApp机器人立即回复激活成功消息
- [ ] H5页面通过实时监听自动跳转到活动主页

### **Epic 2: 用户留存与裂变**

#### **Story 2.1: 用户查看个人状态**
**作为** 一个已激活的用户  
**我希望** 在活动主页看到我的抽奖码和活动状态  
**以便** 我了解自己的参与情况和中奖机会  

**验收标准**:
- [ ] 显示用户身份标识（脱敏手机号或昵称）
- [ ] 突出显示当前拥有的抽奖码总数
- [ ] 提供"查看全部"按钮展示详细抽奖码列表
- [ ] 显示活动倒计时或开奖结果
- [ ] 首次访问的被邀请者看到特殊"欢迎礼物"视图

#### **Story 2.2: 用户邀请好友获得奖励**
**作为** 一个已参与的用户  
**我希望** 通过"利他分享"的方式邀请朋友获得更多抽奖码  
**以便** 我在帮助朋友的同时增加自己的中奖机会  

**验收标准**:
- [ ] **常驻邀请CTA/Toast**: "送好友抽奖码，你可以额外获得X个抽奖码，送的越多你也可以获得更多抽奖码"
- [ ] **一键WhatsApp分享**: 支持快捷跳转到WhatsApp进行分享
  - [ ] 支持分享到WhatsApp群组
  - [ ] 支持分享给个人联系人  
  - [ ] 参考微信一键分享的流畅体验
- [ ] 生成用户专属邀请链接包含ref_id和用户名
- [ ] **关键监听事件**: 好友关注WhatsApp商业号时触发奖励
- [ ] **模板消息反馈**: 分享者收到WhatsApp商业号的自定义模板消息通知
- [ ] 被邀请者激活后实时增加邀请者抽奖码数量
- [ ] 显示"+1"动画和Toast通知"好友XX已加入"
- [ ] **后台配置**: WhatsApp商业号支持多商家配置

#### **Story 2.3: 用户实时收到奖励反馈**
**作为** 一个邀请了朋友的用户  
**我希望** 立即看到邀请成功的反馈和奖励  
**以便** 我有成就感并继续邀请更多朋友  

**验收标准**:
- [ ] 页面通过Supabase Realtime实时监听邀请事件
- [ ] 邀请成功后自动更新抽奖码总数
- [ ] 显示动画效果和个性化Toast通知
- [ ] WhatsApp机器人同时发送通知给邀请者
- [ ] 无需手动刷新页面

### **Epic 3: 开奖与兑奖流程**

#### **Story 3.1: 中奖用户获得庆祝体验**
**作为** 一个中奖的用户  
**我希望** 看到醒目的中奖通知和奖品信息  
**以便** 我感受到中奖的喜悦并了解如何领取奖品  

**验收标准**:
- [ ] **庆祝标题**: 醒目的"恭喜！你已中奖"红色标题
- [ ] **核心奖品卡片**: 红色背景突出显示中奖等级和具体奖品名称
- [ ] **主要CTA**: "立即兑奖"按钮为唯一主要操作，视觉焦点突出
- [ ] **分等级中奖者公示**: 
  - [ ] 一等奖中奖者信息单独展示
  - [ ] 二等奖中奖者信息单独展示  
  - [ ] 三等奖中奖者信息单独展示
  - [ ] 显示头像和脱敏昵称，增强真实性
- [ ] **信息层次设计**: 个人中奖信息 → 立即兑奖按钮 → 分等级公示信息
- [ ] 中奖抽奖码在列表中高亮显示
- [ ] 邀请功能模块被中奖信息替代

#### **Story 3.2: 未中奖用户获得鼓励信息**
**作为** 一个未中奖的用户  
**我希望** 看到透明的中奖结果公示和鼓励信息  
**以便** 我了解活动的公平性并保持对品牌的好感  

**验收标准**:
- [ ] **鼓励标题**: 积极的"感谢参与"或"下期再来"标题
- [ ] **核心鼓励卡片**: 与Story 3.1风格一致的卡片设计，展示鼓励信息
- [ ] **主要CTA**: "关注下期活动"按钮，与Story 3.1的"立即兑奖"位置和样式保持一致
- [ ] **分等级中奖者公示**: 与Story 3.1完全相同的设计
  - [ ] 一等奖中奖者信息单独展示
  - [ ] 二等奖中奖者信息单独展示  
  - [ ] 三等奖中奖者信息单独展示
  - [ ] 显示头像和脱敏昵称，增强透明度
- [ ] **信息层次设计**: 个人未中奖信息 → 关注下期按钮 → 分等级公示信息
- [ ] **设计一致性**: 页面整体风格与Story 3.1庆祝页面保持一致
- [ ] 邀请功能模块被鼓励信息替代
- [ ] 保持积极正面的用户体验，避免"很遗憾"等负面词汇

#### **Story 3.3: 中奖用户完成安全兑奖**
**作为** 一个中奖的用户  
**我希望** 通过安全便捷的流程领取我的奖品，并能随时获得客服支持  
**以便** 我顺利获得奖励并有良好的品牌体验  

**验收标准**:
- [ ] **Token透明展示**: 页面明确显示一次性验证Token，用户可复制保存
- [ ] **客服支持常驻**: 兑奖页面预留WhatsApp客服联系方式
  - [ ] 悬浮客服按钮: "有疑问？联系客服"
  - [ ] 一键跳转到WhatsApp客服对话
  - [ ] 后台可配置客服WhatsApp个人号
- [ ] **多种兑奖方式支持**:
  - [ ] 实物奖品: 收件信息表单填写
  - [ ] 虚拟奖品: 直接显示兑换码和复制功能
  - [ ] **WhatsApp个人号兑奖**: 显示客服个人号，用户主动添加完成兑奖
- [ ] **WhatsApp兑奖流程**:
  - [ ] 显示客服WhatsApp个人号和添加指引
  - [ ] 提供标准话术模板: "我是活动中奖用户，兑奖码: [TOKEN]"
  - [ ] 引导用户截图保存兑奖信息
- [ ] 提交成功后显示确认信息并建议截图保存
- [ ] 防止重复领取和链接滥用
- [ ] **后台配置**: 支持为不同奖品配置不同兑奖方式

### **Epic 4: 商家运营管理**

#### **Story 4.1: 商家创建配置活动**
**作为** 一个商家运营者  
**我希望** 通过直观的管理后台创建和配置抽奖活动的所有元素  
**以便** 我能快速启动营销活动而无需技术支持  

**验收标准**:
- [ ] **基础活动配置**:
  - [ ] 活动名称、时间设置（开始/结束时间）
  - [ ] 活动规则说明（富文本编辑器）
  - [ ] 赞助商信息配置（Logo、名称、官网链接）
- [ ] **视觉内容配置**:
  - [ ] Banner图片上传（主视觉）
  - [ ] 奖品图片上传（展示图+详情大图）
  - [ ] 支持图片预览和批量管理
- [ ] **奖品管理系统**:
  - [ ] 自由增删改奖品项目（等级、名称、数量）
  - [ ] 配置兑奖方式（表单/虚拟兑换码/WhatsApp个人号）
  - [ ] 奖品详情图片上传
- [ ] **跑马灯消息配置**:
  - [ ] 自定义"[头像] xxx参与了抽奖"格式消息
  - [ ] 自定义"[头像] xx邀请了x个人"格式消息
  - [ ] **用户头像管理系统**:
    - [ ] **Google头像优先**: 真实用户优先使用Google登录头像
    - [ ] **降级头像生成**: Google头像缺失时使用DiceBear API生成
    - [ ] **虚拟头像库**: 后台上传管理虚拟用户头像（用于营造氛围）
    - [ ] **头像显示策略**: 真实用户(Google头像) + 虚拟数据(上传头像) 混合展示
    - [ ] 头像样式统一配置（32px圆形、风格一致）
    - [ ] 支持批量虚拟头像上传和预览
  - [ ] 支持虚拟数据和真实数据混合显示
  - [ ] 跑马灯头像显示效果预览
- [ ] **WhatsApp集成配置**:
  - [ ] WhatsApp商业号设置（多商家支持）
  - [ ] 客服个人号配置（兑奖支持）
  - [ ] 模板消息内容自定义
- [ ] **营销参数配置**:
  - [ ] 邀请奖励抽奖码数量设置
  - [ ] 初始参与人数基数配置
  - [ ] CTA按钮文案自定义
- [ ] **系统功能**:
  - [ ] 活动创建向导流程
  - [ ] 实时预览前端页面效果
  - [ ] 草稿保存和发布功能
  - [ ] 配置完整性检查

#### **Story 4.2: 数据分析与追踪** 
**作为** 一个商家运营者  
**我希望** 通过专业的数据分析工具了解活动效果  
**以便** 我评估营销ROI并优化活动策略  

**验收标准**:
- [ ] **Google Analytics 4集成**:
  - [ ] 完整的GA4事件埋点体系
  - [ ] 自定义事件追踪（参与、邀请、中奖、兑奖）
  - [ ] 转化漏斗分析配置
- [ ] **关键事件定义**:
  - [ ] 落地页访问 (page_view)
  - [ ] 参与按钮点击 (participate_click)
  - [ ] 激活成功 (user_activated)
  - [ ] 邀请分享 (invite_share)
  - [ ] 邀请成功 (invite_success)
  - [ ] 开奖查看 (lottery_result_view)
  - [ ] 兑奖完成 (redemption_complete)
- [ ] **自定义维度配置**:
  - [ ] 用户来源类型（自然/邀请）
  - [ ] 邀请层级追踪
  - [ ] 奖品等级分析
  - [ ] 兑奖方式统计
- [ ] **数据Dashboard建议**:
  - [ ] 提供GA4报告模板
  - [ ] 关键指标监控建议
  - [ ] 病毒传播分析方法指导

#### **Story 4.3: 中奖者管理与权限系统**
**作为** 一个商家运营者  
**我希望** 在安全的权限体系下管理中奖用户信息  
**以便** 我能完成奖品发放和用户服务，同时保证数据安全  

**验收标准**:
- [ ] **Admin权限管理系统** (MVP SaaS基础):
  - [ ] 多租户数据隔离（商家只能看到自己的数据）
  - [ ] 角色权限配置（超级管理员/商家管理员/运营人员）
  - [ ] 账户注册审核机制
  - [ ] 登录认证和会话管理
- [ ] **中奖者信息管理**:
  - [ ] 显示所有中奖记录列表
  - [ ] 支持按活动、奖品等级、兑奖状态筛选
  - [ ] 查看中奖者详细信息和收件地址
  - [ ] 标记奖品发放状态
  - [ ] 导出中奖者信息用于物流和财务
- [ ] **数据安全保护**:
  - [ ] 敏感信息脱敏显示
  - [ ] 操作日志记录
  - [ ] 数据访问权限控制

---

## 🔄 **业务流程分析**

### **核心业务流程**

#### **流程1: 新用户激活流程**
```
1. 用户点击邀请链接访问落地页
2. 系统识别邀请者信息并存储ref_id
3. 显示个性化Toast和专属CTA按钮
4. 用户点击参与，生成SESSION_ID
5. 跳转WhatsApp发送预设消息
6. 后台接收消息获取手机号
7. 绑定手机号与SESSION_ID完成激活
8. WhatsApp机器人回复激活成功
9. H5页面监听到激活成功自动跳转
10. 用户进入活动主页查看抽奖码
```

#### **流程2: 病毒式邀请传播流程**
```
1. 已激活用户在活动主页查看邀请任务
2. 系统生成包含用户ID和昵称的专属链接
3. 用户复制链接并分享给朋友
4. 新用户通过邀请链接访问并激活
5. 系统通过ref_id识别邀请关系
6. 为邀请者增加N个抽奖码奖励
7. 实时通知邀请者获得新抽奖码
8. WhatsApp机器人发送恭喜消息
9. 邀请者看到成就反馈继续分享
10. 形成病毒式传播循环
```

#### **流程3: 开奖与兑奖流程**
```
1. 活动到达预设的开奖时间
2. 系统根据奖品清单和抽奖码进行抽奖
3. 生成中奖结果并更新用户状态
4. 中奖用户活动主页变为庆祝视图
5. 未中奖用户看到鼓励视图和中奖号码公示
6. 中奖用户点击"立即兑奖"获得Token链接
7. 访问兑奖页面验证Token有效性
8. 根据奖品类型显示不同兑奖流程
9. 完成信息提交或虚拟奖品复制
10. 系统标记兑奖完成并禁用Token
```

---

## 📄 **页面结构定义**

### **P1: 落地页 (`/`)**
**核心职责**: 流量入口，吸引新用户参与活动

**页面组件结构**:
- Header: 工具名称和操作入口
- Hero Banner: 后台可配置的活动主视觉图片
  - 跑马灯组件: 左上角显示"xxx参与了抽奖"、"xx邀请了x个人"等实时信息
- Prize List: 奖品清单展示（奖品图片支持后台上传）
- Countdown: 活动倒计时
- Sponsor Area: 赞助商信息
- Activity Rules: 活动规则说明
- Main CTA: 核心参与按钮 + 已参与人数显示
- Footer: 页脚信息

**页面状态**:
- S1.1: 默认状态 (自然流量用户)
- S1.2: 邀请状态 (被邀请用户，显示个性化Toast)
- S1.3: 活动结束状态 (显示结束遮罩)

### **P2: 活动主页 (`/home`)**
**核心职责**: 用户个人中心，展示状态和邀请功能

**页面组件结构**:
- Header: 用户身份标识
- My Codes Card: 抽奖码信息展示
- Invite Task Card: 邀请功能区域
- Lottery Status Card: 开奖状态和结果

**页面状态**:
- S2.0: 首次访问的被邀请者 (欢迎礼物视图)
- S2.1: 开奖前常规状态
- S2.2: 开奖后中奖状态 (庆祝视图)
- S2.3: 开奖后未中奖状态 (鼓励视图)

### **P3: 兑奖页 (`/claim`)**
**核心职责**: 中奖用户领取奖品的安全表单

**页面组件结构**:
- Header: 页面标题
- Prize Info Card: 奖品信息确认
- Dynamic Content Area: 动态兑奖内容

**页面状态**:
- S3.1: 待领取实物奖品 (地址表单)
- S3.2: 待领取虚拟奖品 (兑换码显示)
- S3.3: 领取成功确认
- S3.4: 链接无效或过期
- S3.5: 奖品已被领取

---

## ⚙️ **技术架构需求**

### **前端技术栈**
- **基础**: Vite + Vanilla TypeScript
- **样式**: TailwindCSS + 自定义CSS变量系统
- **图标**: FontAwesome Pro
- **实时通信**: Supabase Realtime API
- **状态管理**: 基于状态机的页面状态管理

### **后端技术栈**  
- **数据库**: Supabase PostgreSQL
- **API**: Supabase 自动生成API
- **实时功能**: Supabase Realtime
- **边缘函数**: Supabase Edge Functions
- **第三方集成**: WhatsApp Business API

### **部署和运维**
- **前端部署**: Vercel/Netlify
- **后端服务**: Supabase 托管
- **性能目标**: 首屏加载<2s，交互响应<100ms
- **兼容性**: 现代移动端浏览器

---

## 🔒 **边界条件与约束**

### **技术约束**
- **移动端优先**: 必须完美适配移动端设备
- **WhatsApp依赖**: 核心业务流程依赖WhatsApp Business API
- **实时性要求**: 邀请奖励和状态更新必须实时响应
- **安全性**: 兑奖Token一次性使用，防止滥用

### **业务约束**
- **多语言**: 初期版本仅支持西班牙语
- **奖品配置**: 支持实物和虚拟两种奖品类型
- **活动时效**: 严格按照配置时间控制活动开始和结束
- **数据完整性**: 所有用户行为和奖励发放必须可追溯

### **用户体验约束**
- **简化流程**: 参与流程不超过3步
- **即时反馈**: 所有用户操作必须有明确反馈
- **透明公正**: 开奖结果和中奖信息完全透明
- **错误处理**: 所有异常情况都有友好的错误提示

---

## 📊 **成功指标定义**

### **用户参与指标**
- 激活转化率 >80% (访问→完成激活)
- 邀请转化率 >30% (激活用户→成功邀请至少1人)
- 平均邀请数 >2人/用户
- 页面跳出率 <20%

### **技术性能指标**
- 首屏加载时间 <2s
- 交互响应时间 <100ms
- 实时功能延迟 <1s
- 移动端适配完美率 100%

### **业务价值指标**
- 病毒传播系数 >1.5 (每个用户平均带来1.5个新用户)
- 私域转化率 >90% (参与用户→WhatsApp粉丝)
- 活动完成率 >95% (开始活动→成功结束并兑奖)
- 用户满意度 >4.5/5.0

---

## 🎯 **验收标准总结**

### **功能完整性验收**
- [ ] 所有用户故事的验收标准100%满足
- [ ] 三个页面的所有状态都能正确渲染
- [ ] 业务流程端到端无缺失环节
- [ ] 管理后台所有配置项生效

### **品牌一致性验收**
- [ ] 设计完全符合5个品牌关键词要求
- [ ] UI体现专业、信赖、高效、社交、增长特质
- [ ] 无"AI味"设计元素
- [ ] 视觉风格统一专业

### **技术质量验收**
- [ ] 所有性能指标达标
- [ ] 移动端完美适配
- [ ] 实时功能稳定可靠
- [ ] 安全措施有效防护

---

**文档状态**: 待用户确认审批  
**下一步**: 等待用户确认后进入任务1.2用户流程设计  
**负责人**: UI/UX设计专家  
**创建时间**: 2024年9月29日

---

**重要**: 此需求规格文档是后续设计和开发工作的基础，必须经过用户确认审批后才能进入下一阶段。
