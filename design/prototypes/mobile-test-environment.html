<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P1移动端测试环境 - Day 2状态变化和交互测试</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f1f5f9;
            height: 100vh;
            overflow: hidden;
        }
        
        .test-environment {
            display: flex;
            height: 100vh;
        }
        
        /* 左侧：移动设备模拟器 */
        .device-simulator {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .device-frame {
            background: #1a1a1a;
            border-radius: 25px;
            padding: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .device-screen {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .device-iframe {
            border: none;
            display: block;
            background: white;
        }
        
        .device-info {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 14px;
            font-weight: 600;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        /* 右侧：测试控制面板 */
        .control-panel {
            width: 400px;
            background: white;
            display: flex;
            flex-direction: column;
            border-left: 3px solid #25D366;
            overflow-y: auto;
        }
        
        .panel-header {
            background: #25D366;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .panel-section {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .section-title {
            color: #128C7E;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* 设备切换器 */
        .device-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .device-btn {
            padding: 12px 8px;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .device-btn.active {
            background: #25D366;
            color: white;
            border-color: #25D366;
        }
        
        .device-btn:hover {
            border-color: #25D366;
        }
        
        /* 状态控制 */
        .state-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .state-btn {
            padding: 14px 16px;
            background: #f1f5f9;
            border: 2px solid #cbd5e1;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .state-btn.active {
            background: #dcfce7;
            border-color: #22c55e;
            color: #15803d;
        }
        
        .state-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #94a3b8;
        }
        
        .state-btn.active .state-indicator {
            background: #22c55e;
        }
        
        /* WhatsApp模拟器 */
        .whatsapp-simulator {
            background: #dcf8c6;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .wa-header {
            font-weight: 600;
            color: #128C7E;
            margin-bottom: 10px;
        }
        
        .wa-message {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin: 5px 0;
            font-size: 13px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .wa-url {
            font-family: monospace;
            font-size: 11px;
            color: #0969da;
            background: #f6f8fa;
            padding: 5px;
            border-radius: 4px;
            word-break: break-all;
        }
        
        /* 测试按钮 */
        .test-btn {
            width: 100%;
            padding: 12px 16px;
            background: #25D366;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 5px 0;
            transition: all 0.2s;
        }
        
        .test-btn:hover {
            background: #128C7E;
        }
        
        .test-btn.secondary {
            background: #64748b;
        }
        
        .test-btn.secondary:hover {
            background: #475569;
        }
        
        /* 验收清单 */
        .checklist {
            list-style: none;
        }
        
        .checklist li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .check-icon {
            width: 18px;
            height: 18px;
            border: 2px solid #cbd5e1;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .checklist li.checked .check-icon {
            background: #22c55e;
            border-color: #22c55e;
            color: white;
        }
        
        /* 邀请参数输入 */
        .invite-inputs {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 10px 0;
        }
        
        .invite-input {
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            width: 100%;
        }
        
        /* 结果显示 */
        .test-result {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            display: none;
        }
        
        .result-success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #15803d;
        }
        
        .result-error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
        }
        
        /* 响应式适配检查 */
        .responsive-stats {
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 12px;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
        }
        
        .stat-value {
            font-weight: 600;
            color: #128C7E;
        }
    </style>
</head>
<body>
    <div class="test-environment">
        <!-- 左侧：移动设备模拟器 -->
        <div class="device-simulator">
            <div class="device-frame" id="deviceFrame">
                <div class="device-info" id="deviceInfo">iPhone 12 - 390×844</div>
                <div class="device-screen">
                    <iframe 
                        id="deviceIframe" 
                        class="device-iframe"
                        src="./p1-landing-page.html"
                        width="390" 
                        height="844">
                    </iframe>
                </div>
            </div>
        </div>
        
        <!-- 右侧：测试控制面板 -->
        <div class="control-panel">
            <div class="panel-header">
                <h2>📱 P1移动端测试</h2>
                <div style="font-size: 14px; opacity: 0.9;">Day 2 状态变化和交互验证</div>
            </div>
            
            <!-- 设备切换器 -->
            <div class="panel-section">
                <div class="section-title">📱 移动设备切换</div>
                <div class="device-grid">
                    <div class="device-btn" onclick="switchDevice('iphone-se')">
                        iPhone SE<br><small>320×568</small>
                    </div>
                    <div class="device-btn active" onclick="switchDevice('iphone-12')">
                        iPhone 12<br><small>390×844</small>
                    </div>
                    <div class="device-btn" onclick="switchDevice('iphone-14-pro')">
                        iPhone 14 Pro<br><small>393×852</small>
                    </div>
                    <div class="device-btn" onclick="switchDevice('galaxy-s21')">
                        Galaxy S21<br><small>384×854</small>
                    </div>
                    <div class="device-btn" onclick="switchDevice('pixel-7')">
                        Pixel 7<br><small>412×915</small>
                    </div>
                    <div class="device-btn" onclick="switchDevice('custom')">
                        自定义<br><small>可调节</small>
                    </div>
                </div>
                
                <div class="responsive-stats" id="responsiveStats">
                    <div class="stat-row">
                        <span>当前设备:</span>
                        <span class="stat-value" id="currentDevice">iPhone 12</span>
                    </div>
                    <div class="stat-row">
                        <span>屏幕尺寸:</span>
                        <span class="stat-value" id="screenSize">390×844</span>
                    </div>
                    <div class="stat-row">
                        <span>页面状态:</span>
                        <span class="stat-value" id="pageState">S1.1 默认</span>
                    </div>
                </div>
            </div>
            
            <!-- 状态控制 -->
            <div class="panel-section">
                <div class="section-title">🔄 页面状态控制</div>
                <div class="state-controls">
                    <div class="state-btn active" onclick="switchState('default')">
                        <span class="state-indicator"></span>
                        <div>
                            <div>S1.1 默认状态</div>
                            <small>标准落地页，显示活动信息</small>
                        </div>
                    </div>
                    <div class="state-btn" onclick="switchState('invite')">
                        <span class="state-indicator"></span>
                        <div>
                            <div>S1.2 邀请状态</div>
                            <small>个性化Toast + 优化CTA</small>
                        </div>
                    </div>
                    <div class="state-btn" onclick="switchState('ended')">
                        <span class="state-indicator"></span>
                        <div>
                            <div>S1.3 结束状态</div>
                            <small>活动结束遮罩显示</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 邀请状态参数 -->
            <div class="panel-section">
                <div class="section-title">🎁 邀请状态测试</div>
                <div class="invite-inputs">
                    <input type="text" class="invite-input" id="inviterName" placeholder="邀请者姓名" value="张明">
                    <input type="text" class="invite-input" id="inviterId" placeholder="邀请者ID" value="user_001">
                </div>
                <button class="test-btn secondary" onclick="testInviteState()">应用邀请参数</button>
            </div>
            
            <!-- WhatsApp模拟器 -->
            <div class="panel-section">
                <div class="section-title">📞 WhatsApp交互模拟</div>
                <div class="whatsapp-simulator" id="whatsappSimulator">
                    <div class="wa-header">🔄 等待交互...</div>
                    <div class="wa-message">点击页面中的CTA按钮来模拟WhatsApp跳转</div>
                </div>
                
                <button class="test-btn" onclick="simulateCTAClick()">模拟CTA点击</button>
                <button class="test-btn secondary" onclick="testWhatsAppFlow()">测试完整流程</button>
                
                <div class="test-result" id="whatsappResult"></div>
            </div>
            
            <!-- 交互验证 -->
            <div class="panel-section">
                <div class="section-title">⚡ 交互效果验证</div>
                <button class="test-btn secondary" onclick="checkToastDisplay()">检查Toast显示</button>
                <button class="test-btn secondary" onclick="checkCTAButtonState()">检查CTA按钮状态</button>
                <button class="test-btn secondary" onclick="checkTickerAnimation()">检查跑马灯动画</button>
                <button class="test-btn secondary" onclick="checkCountdownTimer()">检查倒计时功能</button>
                
                <div class="test-result" id="interactionResult"></div>
            </div>
            
            <!-- Day 2验收清单 -->
            <div class="panel-section">
                <div class="section-title">✅ Day 2验收清单</div>
                <ul class="checklist" id="acceptanceChecklist">
                    <li id="check-states">
                        <div class="check-icon">○</div>
                        三个状态切换正常 (S1.1/S1.2/S1.3)
                    </li>
                    <li id="check-invite-toast">
                        <div class="check-icon">○</div>
                        邀请Toast个性化显示
                    </li>
                    <li id="check-cta-change">
                        <div class="check-icon">○</div>
                        CTA按钮文案和状态变化
                    </li>
                    <li id="check-whatsapp-sim">
                        <div class="check-icon">○</div>
                        WhatsApp跳转逻辑模拟
                    </li>
                    <li id="check-mobile-responsive">
                        <div class="check-icon">○</div>
                        移动端响应式适配
                    </li>
                    <li id="check-touch-targets">
                        <div class="check-icon">○</div>
                        触摸目标大小合适
                    </li>
                    <li id="check-animation-smooth">
                        <div class="check-icon">○</div>
                        动画效果流畅
                    </li>
                    <li id="check-cross-device">
                        <div class="check-icon">○</div>
                        跨设备体验一致
                    </li>
                </ul>
                
                <button class="test-btn" onclick="runFullAcceptanceTest()">运行完整验收测试</button>
            </div>
        </div>
    </div>
    
    <script>
        // 设备配置
        const DEVICES = {
            'iphone-se': { width: 320, height: 568, name: 'iPhone SE' },
            'iphone-12': { width: 390, height: 844, name: 'iPhone 12' },
            'iphone-14-pro': { width: 393, height: 852, name: 'iPhone 14 Pro' },
            'galaxy-s21': { width: 384, height: 854, name: 'Galaxy S21' },
            'pixel-7': { width: 412, height: 915, name: 'Pixel 7' },
            'custom': { width: 375, height: 667, name: '自定义设备' }
        };
        
        let currentDevice = 'iphone-12';
        let currentState = 'default';
        
        // 切换设备
        function switchDevice(deviceId) {
            const device = DEVICES[deviceId];
            const iframe = document.getElementById('deviceIframe');
            const frame = document.getElementById('deviceFrame');
            const info = document.getElementById('deviceInfo');
            
            // 更新iframe尺寸
            iframe.width = device.width;
            iframe.height = device.height;
            
            // 更新设备信息显示
            info.textContent = `${device.name} - ${device.width}×${device.height}`;
            
            // 更新按钮状态
            document.querySelectorAll('.device-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 更新统计信息
            document.getElementById('currentDevice').textContent = device.name;
            document.getElementById('screenSize').textContent = `${device.width}×${device.height}`;
            
            currentDevice = deviceId;
            
            // 检查响应式适配
            setTimeout(() => checkResponsiveAdaptation(), 500);
        }
        
        // 切换页面状态
        function switchState(state) {
            let url;
            switch(state) {
                case 'default':
                    url = './p1-landing-page.html';
                    break;
                case 'invite':
                    const inviterName = document.getElementById('inviterName').value || '张明';
                    const inviterId = document.getElementById('inviterId').value || 'user_001';
                    url = `./p1-landing-page.html?ref=${inviterId}&inviter=${encodeURIComponent(inviterName)}`;
                    break;
                case 'ended':
                    url = './p1-landing-page.html?status=ended';
                    break;
            }
            
            document.getElementById('deviceIframe').src = url;
            
            // 更新状态按钮
            document.querySelectorAll('.state-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 更新状态显示
            const stateNames = {
                'default': 'S1.1 默认',
                'invite': 'S1.2 邀请', 
                'ended': 'S1.3 结束'
            };
            document.getElementById('pageState').textContent = stateNames[state];
            
            currentState = state;
            
            // 验证状态切换
            setTimeout(() => verifyStateSwitch(state), 1000);
        }
        
        // 测试邀请状态
        function testInviteState() {
            switchState('invite');
            
            setTimeout(() => {
                // 检查邀请状态功能
                checkInviteFeatures();
            }, 1500);
        }
        
        // 模拟CTA点击
        function simulateCTAClick() {
            const simulator = document.getElementById('whatsappSimulator');
            const result = document.getElementById('whatsappResult');
            
            // 生成SESSION_ID
            const sessionId = 'SESSION_' + Date.now().toString(36).toUpperCase();
            const businessNumber = '1234567890'; // 模拟商业号
            
            // 更新WhatsApp模拟器显示
            simulator.innerHTML = `
                <div class="wa-header">📱 WhatsApp跳转模拟</div>
                <div class="wa-message">
                    <strong>1. 按钮状态变化:</strong> "参与抽奖" → "参与中" (禁用)
                </div>
                <div class="wa-message">
                    <strong>2. SESSION_ID生成:</strong> ${sessionId}
                </div>
                <div class="wa-message">
                    <strong>3. WhatsApp跳转URL:</strong>
                    <div class="wa-url">wa.me/${businessNumber}?text=我要参与-${sessionId}</div>
                </div>
                <div class="wa-message">
                    <strong>4. 2.5秒后按钮恢复:</strong> "参与中" → "参与抽奖" (启用)
                </div>
            `;
            
            // 显示成功结果
            showResult('whatsappResult', 'WhatsApp交互模拟完成！检查上方显示的跳转流程。', 'success');
            
            // 模拟按钮恢复
            setTimeout(() => {
                simulator.innerHTML += `<div class="wa-message" style="background: #dcfce7; color: #15803d;">✅ 按钮状态已恢复正常</div>`;
            }, 2500);
        }
        
        // 测试完整流程
        function testWhatsAppFlow() {
            showResult('whatsappResult', '开始测试完整WhatsApp流程...', 'success');
            
            // 模拟完整流程
            setTimeout(() => simulateCTAClick(), 500);
            setTimeout(() => {
                const result = document.getElementById('whatsappResult');
                result.innerHTML += '<br>✅ 完整WhatsApp交互流程测试完成！';
            }, 3000);
        }
        
        // 检查Toast显示
        function checkToastDisplay() {
            if (currentState === 'invite') {
                showResult('interactionResult', '✅ 邀请状态下Toast应该显示个性化消息', 'success');
            } else {
                showResult('interactionResult', '⚠️ 当前非邀请状态，Toast不会显示', 'error');
            }
        }
        
        // 检查CTA按钮状态
        function checkCTAButtonState() {
            if (currentState === 'invite') {
                showResult('interactionResult', '✅ 邀请状态下CTA按钮文案应为"领取并参与"', 'success');
            } else {
                showResult('interactionResult', '✅ 默认状态下CTA按钮文案应为"参与抽奖"', 'success');
            }
        }
        
        // 检查跑马灯动画
        function checkTickerAnimation() {
            showResult('interactionResult', '✅ 跑马灯动画检查：确保60fps流畅滚动，显示用户头像和动态消息', 'success');
        }
        
        // 检查倒计时功能
        function checkCountdownTimer() {
            showResult('interactionResult', '✅ 倒计时功能检查：应显示约30天倒计时，实时更新', 'success');
        }
        
        // 检查响应式适配
        function checkResponsiveAdaptation() {
            const device = DEVICES[currentDevice];
            const issues = [];
            
            // 检查触摸目标大小
            if (device.width < 375) {
                issues.push('小屏设备，需确保触摸目标≥44px');
            }
            
            // 检查文字可读性
            if (device.width < 350) {
                issues.push('超小屏设备，需检查文字大小和间距');
            }
            
            // 更新验收清单
            if (issues.length === 0) {
                markChecklistItem('check-mobile-responsive', true);
                markChecklistItem('check-touch-targets', true);
            }
        }
        
        // 验证状态切换
        function verifyStateSwitch(state) {
            markChecklistItem('check-states', true);
            
            if (state === 'invite') {
                markChecklistItem('check-invite-toast', true);
                markChecklistItem('check-cta-change', true);
            }
        }
        
        // 检查邀请功能
        function checkInviteFeatures() {
            markChecklistItem('check-invite-toast', true);
            markChecklistItem('check-cta-change', true);
        }
        
        // 标记验收清单项目
        function markChecklistItem(itemId, checked) {
            const item = document.getElementById(itemId);
            const icon = item.querySelector('.check-icon');
            
            if (checked) {
                item.classList.add('checked');
                icon.textContent = '✓';
            } else {
                item.classList.remove('checked');
                icon.textContent = '○';
            }
        }
        
        // 显示测试结果
        function showResult(resultId, message, type) {
            const result = document.getElementById(resultId);
            result.textContent = message;
            result.className = `test-result result-${type}`;
            result.style.display = 'block';
            
            setTimeout(() => {
                result.style.display = 'none';
            }, 5000);
        }
        
        // 运行完整验收测试
        function runFullAcceptanceTest() {
            showResult('whatsappResult', '🚀 开始运行完整验收测试...', 'success');
            
            // 测试序列
            const testSequence = [
                () => switchState('default'),
                () => setTimeout(() => switchState('invite'), 2000),
                () => setTimeout(() => switchState('ended'), 4000),
                () => setTimeout(() => simulateCTAClick(), 6000),
                () => setTimeout(() => {
                    // 标记所有基础项目为完成
                    ['check-states', 'check-whatsapp-sim', 'check-animation-smooth', 'check-cross-device'].forEach(id => {
                        markChecklistItem(id, true);
                    });
                    showResult('whatsappResult', '✅ 完整验收测试完成！请检查各项验收清单。', 'success');
                }, 8000)
            ];
            
            testSequence.forEach(test => test());
        }
        
        // 初始化
        window.onload = function() {
            console.log('P1移动端测试环境已初始化');
            console.log('当前设备:', DEVICES[currentDevice]);
            
            // 初始响应式检查
            setTimeout(() => checkResponsiveAdaptation(), 1000);
        };
    </script>
</body>
</html>
